<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

    <!-- PWA / App Mode -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">

    <title>Fiat Invaders Alpha 2.0</title>

    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-512.png">
    <link rel="icon" type="image/x-icon" href="icon-512.png">
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div class="scanlines"></div>
    <div class="vignette"></div>

    <canvas id="gameCanvas"></canvas>

    <div id="ui-layer">
        <!-- In-Game Settings Button -->
        <button id="btn-settings" onclick="toggleSettings()" ontouchstart="event.stopPropagation()"
            style="pointer-events: auto;">‚ò∞</button>

        <!-- TOP BAR: Lives/Health | SCORE | Level/Shield -->
        <!-- TOP BAR: Lives/Health | SCORE | Level/Shield -->
        <!-- ROCK SOLID HUD REWRITE -->
        <div class="hud-top-bar">
            <!-- LEFT MODULE: LIVES -->
            <div class="hud-module left">
                <span class="label">VITE</span>
                <span id="livesText" class="value">3</span>
                <div class="bar-container health-container">
                    <div id="healthBar"></div>
                </div>
            </div>

            <!-- CENTER MODULE: SCORE -->
            <div class="hud-module center">
                <span class="label">PUNTI</span>
                <span id="scoreVal" class="value">0</span>
            </div>

            <!-- RIGHT MODULE: LEVEL & SHIELD -->
            <div class="hud-module right">
                <span class="label">LIVELLO</span>
                <span id="lvlVal" class="value">1</span>
                <div class="bar-container shield-container">
                    <div id="shieldBar"></div>
                </div>
            </div>
        </div>

        <!-- Global Shield Bar Removed -->
    </div>
    </div>

    <div id="splash-layer">
        <video id="intro-video" src="splashscreen.mp4" playsinline autoplay muted></video>
    </div>

    <div id="intro-screen" style="display: none;">

        <div class="intro-header">
            <h1 class="neon-title">FIAT<br>INVADERS</h1>
            <div class="subtitle">PANIC SELLING UPDATE</div>
            <div id="version-tag" style="color: #4a6fa5; font-size: 14px; margin-top: -10px; margin-bottom: 15px;">
            </div>
        </div>

        <div id="hero-showcase">
            <!-- SVG HERO SHIP (Centered & Glow Fixed) -->
            <svg viewBox="0 0 100 100" width="160" height="160" style="overflow: visible;">
                <defs>
                    <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
                        <feGaussianBlur stdDeviation="4" result="blur" />
                        <feComposite in="SourceGraphic" in2="blur" operator="over" />
                    </filter>
                </defs>
                <g filter="url(#glow)">
                    <!-- Centered Triangle: Top(50,15), BottomRight(80,75), BottomLeft(20,75) -->
                    <path d="M50 15 L80 75 L50 65 L20 75 Z" fill="#F7931A" stroke="#3498db" stroke-width="3" />
                    <!-- Inner Detail -->
                    <path d="M50 30 L65 70 L50 60 L35 70 Z" fill="#ffffff" opacity="0.3" />
                    <!-- BTC LOGO -->
                    <text x="50" y="62" font-family="Arial" font-weight="900" font-size="28" text-anchor="middle"
                        fill="#ffffff" opacity="1">‚Çø</text>
                </g>
            </svg>
        </div>

        <div class="highscore-display">TOP SCORE: <span id="highScoreVal">0</span></div>

        <div class="intro-action">
            <button class="btn-coin" onclick="goToHangar()">INSERT COIN</button>
            <div class="menu-row">
                <button class="icon-btn mute-toggle">üîá</button>
                <button class="icon-btn" onclick="toggleSettings()">‚öôÔ∏è</button>
                <button class="icon-btn" onclick="toggleLang()" id="lang-btn">EN</button>
            </div>
            <button class="btn-bear" onclick="toggleBearMode()">üêª BEAR MARKET</button>
        </div>
    </div>

    <!-- HANGAR SCREEN -->
    <div id="hangar-screen" style="display: none;">
        <h2 class="neon-title" style="font-size: 30px;">SELECT SHIP</h2>
        <div class="ship-container">
            <!-- BTC STRIKER -->
            <div class="ship-card" onclick="selectShip('BTC')" data-ship="BTC">
                <div class="ship-icon" style="color: #F7931A;">üöÄ</div>
                <h3>BTC STRIKER</h3>
                <div class="stats">
                    <div class="stat"><span class="stat-label">SPD:</span>
                        <div class="bar">
                            <div style="width: 60%; background: #F7931A;"></div>
                        </div>
                    </div>
                    <div class="stat"><span class="stat-label">PWR:</span>
                        <div class="bar">
                            <div style="width: 70%; background: #F7931A;"></div>
                        </div>
                    </div>
                    <div class="stat"><span class="stat-label">HP:</span> <span style="color:#F7931A">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
                    </div>
                </div>
            </div>
            <!-- ETH HEAVY -->
            <div class="ship-card" onclick="selectShip('ETH')" data-ship="ETH">
                <div class="ship-icon" style="color: #8c7ae6;">üõ°Ô∏è</div>
                <h3>ETH HEAVY</h3>
                <div class="stats">
                    <div class="stat"><span class="stat-label">SPD:</span>
                        <div class="bar">
                            <div style="width: 40%; background: #8c7ae6;"></div>
                        </div>
                    </div>
                    <div class="stat"><span class="stat-label">PWR:</span>
                        <div class="bar">
                            <div style="width: 90%; background: #8c7ae6;"></div>
                        </div>
                    </div>
                    <div class="stat"><span class="stat-label">HP:</span> <span style="color:#8c7ae6">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
                    </div>
                </div>
            </div>
            <!-- SOL SPEEDSTER -->
            <div class="ship-card" onclick="selectShip('SOL')" data-ship="SOL">
                <div class="ship-icon" style="color: #00d2d3;">‚ö°</div>
                <h3>SOL SPEEDSTER</h3>
                <div class="stats">
                    <div class="stat"><span class="stat-label">SPD:</span>
                        <div class="bar">
                            <div style="width: 95%; background: #00d2d3;"></div>
                        </div>
                    </div>
                    <div class="stat"><span class="stat-label">PWR:</span>
                        <div class="bar">
                            <div style="width: 50%; background: #00d2d3;"></div>
                        </div>
                    </div>
                    <div class="stat"><span class="stat-label">HP:</span> <span style="color:#00d2d3">‚ù§Ô∏è‚ù§Ô∏è</span></div>
                </div>
            </div>
        </div>
        <button class="btn-coin mini" onclick="backToIntro()">BACK</button>
    </div>

    <!-- SETTINGS MODAL -->
    <div id="settings-modal" style="display: none;">
        <div class="modal-content">
            <h2 style="color: #fff; margin-top: 0;">SETTINGS</h2>
            <div class="setting-row">
                <span>LANGUAGE:</span>
                <button class="toggle-btn" onclick="toggleLang()" id="lang-btn">EN</button>
            </div>
            <div class="how-to-play">
                <h3>HOW TO PLAY</h3>
                <p>‚å®Ô∏è DESKTOP: Arrows to Move ‚Ä¢ Space to Shoot ‚Ä¢ Down for Shield</p>
                <p>üì± MOBILE: Touch sides to Move ‚Ä¢ Tap Icon for Shield</p>
                <p style="color: #F7931A;">‚ÑπÔ∏è TIPS: Stop moving to engage HODL MODE (Double Score).</p>
            </div>
            <button class="btn-coin mini" onclick="toggleSettings()">CLOSE</button>
        </div>
    </div>

    <!-- PAUSE SCREEN -->
    <!-- PAUSE SCREEN UI UPGRADE -->
    <div id="pause-screen" style="display: none;">
        <h1 class="neon-title" style="color: #fff; text-shadow: 0 0 20px #fff;">PAUSED</h1>
        <div class="subtitle" style="margin-bottom: 40px; color: #888;">SYSTEM HALTED</div>

        <button class="btn-coin" id="btn-resume" onclick="togglePause()">RESUME</button>
        <button class="btn-coin" id="btn-restart" onclick="restartGame()"
            style="background: #F7931A; border-color: #F7931A; color: #000;">RESTART MISSION</button>
        <button class="btn-coin" id="btn-exit" onclick="backToIntro()"
            style="background: #e74c3c; border-color: #e74c3c;">EXIT TO MENU</button>

        <div class="menu-row" style="margin-top: 40px;">
            <button class="icon-btn mute-toggle">üîá</button>
        </div>
    </div>

    <div id="gameover-screen" style="display: none;">
        <h1 class="glitch-text">REKT</h1>
        <p id="roast-msg"
            style="color: #F7931A; font-family: 'Courier New', monospace; font-size: 18px; margin: 10px 0;">PORTFOLIO
            VALUE</p>
        <div class="final-score"><span id="finalScore">0</span></div>
        <button class="btn-coin" onclick="backToIntro()">BUY THE DIP</button>
        <div class="menu-row">
            <button class="icon-btn mute-toggle">üîá</button>
            <button class="icon-btn" onclick="toggleSettings()">‚öôÔ∏è</button>
        </div>
    </div>

    <!-- LEVEL COMPLETE SCREEN -->
    <div id="level-complete-screen" style="display: none;">
        <h1 class="neon-title" style="color: #00ff00; text-shadow: 0 0 20px #00ff00;">MARKET<br>CONQUERED</h1>
        <div class="subtitle" style="color: #FFD700; margin-bottom: 30px;">CYCLE COMPLETE</div>

        <div class="stats-box" style="margin-bottom: 30px;">
            <p>BONUS: <span style="color:#00ff00;">+5000</span></p>
            <p>NEXT DIFFICULTY: <span style="color:#ff0000;">+20%</span></p>
        </div>

        <button class="btn-coin" onclick="nextLevel()">NEXT CYCLE üöÄ</button>
    </div>

    <div id="touchControls">
        <div class="touch-zone-left" id="t-left"></div>
        <div class="touch-zone-right" id="t-right"></div>
        <div class="touch-shield-btn" id="t-shield">üõ°Ô∏è</div>
    </div>

    <!-- Ordered Scripts for file:// compatibility (Namespace Pattern) -->
    <script src="src/utils/Constants.js"></script>
    <script src="src/core/AudioSystem.js"></script>
    <script src="src/core/InputSystem.js"></script>
    <script src="src/core/ObjectPool.js"></script>
    <script src="src/entities/Entity.js"></script>
    <script src="src/entities/Bullet.js"></script>
    <script src="src/entities/Player.js"></script>
    <script src="src/entities/Enemy.js"></script>
    <script src="src/entities/Boss.js"></script>
    <script src="src/entities/PowerUp.js"></script>
    <script src="src/managers/WaveManager.js"></script>
    <script type="module" src="src/main.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW Registered!', reg.scope))
                    .catch(err => console.log('SW Failed:', err));
            });
        }
    </script>
</body>

</html>