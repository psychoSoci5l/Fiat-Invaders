<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

    <!-- PWA / App Mode -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">

    <title>FIAT vs CRYPTO</title>

    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-512.png">
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div class="scanlines"></div>
    <div class="vignette"></div>

    <!-- Curtain Effect (Top/Bottom panels) -->
    <div id="curtain-overlay">
        <div class="curtain-left"></div>  <!-- Top panel -->
        <div class="curtain-right"></div> <!-- Bottom panel -->
    </div>

    <!-- Splash Video (fullscreen, outside container) -->
    <div id="splash-layer">
        <video id="intro-video" src="splashscreen.mp4" playsinline autoplay muted></video>
    </div>

    <!-- Game Container: respects safe areas in Safari, fullscreen in PWA -->
    <div id="game-container">
        <canvas id="gameCanvas"></canvas>

        <div id="ui-layer">
        <!-- TOP BAR v4.4: Compact single-row HUD -->
        <div class="hud-top-bar">
            <div class="hud-lives">
                <span class="hud-heart">&#9829;</span><span id="livesText">3</span>
            </div>

            <div class="hud-score-compact">
                <span id="scoreVal" class="hud-score-value">0</span>
            </div>

            <div class="hud-level">
                <span id="lvlVal">1</span>
            </div>
        </div>

        <!-- Graze Meter -->
        <div id="graze-meter">
            <div id="graze-fill"></div>
            <span id="graze-label">GRAZE</span>
            <span id="graze-count">0</span>
        </div>
    </div>

    <div id="message-strip">
        <span class="strip-text"></span>
    </div>

    <div id="intro-screen" style="display: none;">
        <!-- UNIFIED INTRO v4.8 - Redesigned with mode selector -->

        <!-- TITLE (visible in splash, hidden in selection) -->
        <h1 class="game-title intro-title" id="intro-title">
            <span class="title-subtitle" id="title-subtitle">Currencies</span>
            <span class="title-fiat">FIAT</span>
            <span class="title-vs">vs</span>
            <span class="title-crypto">CRYPTO</span>
        </h1>

        <!-- HEADER (hidden in splash, visible in selection) -->
        <div class="selection-header" id="selection-header" style="display: none;">CHOOSE YOUR SHIP</div>

        <!-- SHIP AREA (hidden in SPLASH, visible in SELECTION) -->
        <div class="ship-area hidden">
            <button class="ship-arrow ship-arrow-left" id="arrow-left" onclick="cycleShip(-1)" style="visibility: hidden;">‚Äπ</button>
            <div class="ship-preview-center">
                <canvas id="intro-ship-canvas" width="160" height="180"></canvas>
            </div>
            <button class="ship-arrow ship-arrow-right" id="arrow-right" onclick="cycleShip(1)" style="visibility: hidden;">‚Ä∫</button>
        </div>

        <!-- SHIP INFO (hidden in splash, visible in selection) -->
        <div class="selection-info" id="selection-info" style="display: none;">
            <div id="ship-name" class="ship-name-large">BTC STRIKER</div>
            <div id="ship-stats" class="ship-stats-large">
                <span class="stat-item">SPD ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë</span>
                <span class="stat-item">PWR ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë</span>
                <span class="stat-item">HIT ‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë</span>
            </div>
        </div>

        <!-- MODE SELECTOR (visible in splash, hidden in selection) - v4.8.1 minimal style -->
        <div class="mode-selector" id="mode-selector">
            <div class="mode-pills">
                <button class="mode-pill active" id="mode-pill-story" onclick="setGameMode('campaign')">STORY</button>
                <button class="mode-pill" id="mode-pill-arcade" onclick="setGameMode('arcade')">ARCADE</button>
            </div>
        </div>

        <!-- MODE EXPLANATION (visible in SPLASH only) -->
        <div class="mode-explanation" id="mode-explanation">
            <p class="mode-desc" id="mode-story-desc" data-i18n="MODE_STORY_DESC">
                Follow Bitcoin's rise against central banks.
            </p>
            <p class="mode-desc" id="mode-arcade-desc" data-i18n="MODE_ARCADE_DESC" style="display: none;">
                Endless waves. High scores. Pure action.
            </p>
        </div>

        <!-- CURRENT MODE INDICATOR (hidden in splash, visible in selection) -->
        <div class="current-mode-indicator" id="current-mode-indicator" style="display: none;" onclick="goBackToModeSelect()">
            <span class="mode-indicator-text" id="mode-indicator-text">STORY MODE</span>
            <span class="mode-indicator-hint" id="mode-indicator-hint">tap to change</span>
        </div>

        <!-- HIGH SCORE ROW (visible in selection only) -->
        <div class="selection-score-row" id="selection-score-row" style="display: none;">
            <span class="score-row-label" id="score-row-label">HIGH SCORE</span>
            <span class="score-row-value" id="badge-score-value">0</span>
        </div>

        <!-- PRIMARY ACTION BUTTON (fixed position for double-tap) -->
        <div class="primary-action-container">
            <button class="btn btn-cta btn-lg" id="btn-primary-action" onclick="handlePrimaryAction()">
                TAP TO START
            </button>
        </div>

        <!-- PWA Install Banner -->
        <div id="pwa-install-banner" style="display: none;">
            <div class="pwa-banner-content">
                <span id="pwa-banner-text"></span>
                <button id="pwa-banner-action" class="btn btn-pwa"></button>
                <button id="pwa-banner-close" class="pwa-banner-close">&times;</button>
            </div>
        </div>

        <!-- BOTTOM ICONS (always visible) -->
        <div class="intro-icons">
            <button class="btn btn-icon music-toggle" id="intro-music-toggle">
                <svg viewBox="0 0 24 24" class="icon-svg"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55C7.79 13 6 14.79 6 17s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>
            </button>
            <button class="btn btn-icon sfx-toggle" id="intro-sfx-toggle">
                <svg viewBox="0 0 24 24" class="icon-svg"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/></svg>
            </button>
            <button class="btn btn-icon" onclick="toggleSettings()" id="intro-settings">
                <svg viewBox="0 0 24 24" class="icon-svg"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
            </button>
            <button class="btn btn-icon" onclick="toggleManual()" id="intro-manual">
                <svg viewBox="0 0 24 24" class="icon-svg"><path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"/></svg>
            </button>
        </div>

        <div class="intro-version" id="version-tag"></div>
    </div>

    <!-- HANGAR SCREEN -->
    <div id="hangar-screen" style="display: none;">
        <h2 class="neon-title" style="font-size: 28px;">SELECT SHIP</h2>
        <div class="ship-container">
            <!-- BTC STRIKER -->
            <div class="ship-card" onclick="selectShip('BTC')" data-ship="BTC">
                <div class="ship-icon" style="color: #F7931A;">‚Çø</div>
                <h3 style="color: #F7931A;">BTC STRIKER</h3>
                <div class="ship-trait" style="color: #aaa; font-size: 11px; margin-bottom: 8px;">‚öñÔ∏è BALANCED</div>
                <div class="stats">
                    <div class="stat-row">
                        <span class="stat-icon">üí®</span>
                        <span class="stat-name">Speed</span>
                        <span class="stat-value" style="color:#F7931A">‚óè‚óè‚óè‚óã‚óã</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-icon">üí•</span>
                        <span class="stat-name">Damage</span>
                        <span class="stat-value" style="color:#F7931A">‚óè‚óè‚óè‚óã‚óã</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-icon">üî´</span>
                        <span class="stat-name">Fire Rate</span>
                        <span class="stat-value" style="color:#F7931A">‚óè‚óè‚óè‚óã‚óã</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-icon">‚≠ï</span>
                        <span class="stat-name">Hitbox</span>
                        <span class="stat-value" style="color:#F7931A">‚óè‚óè‚óè‚óã‚óã</span>
                    </div>
                </div>
            </div>
            <!-- ETH HEAVY -->
            <div class="ship-card" onclick="selectShip('ETH')" data-ship="ETH">
                <div class="ship-icon" style="color: #8c7ae6;">Œû</div>
                <h3 style="color: #8c7ae6;">ETH HEAVY</h3>
                <div class="ship-trait" style="color: #aaa; font-size: 11px; margin-bottom: 8px;">üéØ HIGH DAMAGE</div>
                <div class="stats">
                    <div class="stat-row">
                        <span class="stat-icon">üí®</span>
                        <span class="stat-name">Speed</span>
                        <span class="stat-value" style="color:#8c7ae6">‚óè‚óè‚óã‚óã‚óã</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-icon">üí•</span>
                        <span class="stat-name">Damage</span>
                        <span class="stat-value" style="color:#8c7ae6">‚óè‚óè‚óè‚óè‚óè</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-icon">üî´</span>
                        <span class="stat-name">Fire Rate</span>
                        <span class="stat-value" style="color:#8c7ae6">‚óè‚óã‚óã‚óã‚óã</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-icon">‚≠ï</span>
                        <span class="stat-name">Hitbox</span>
                        <span class="stat-value" style="color:#8c7ae6">‚óè‚óè‚óã‚óã‚óã</span>
                    </div>
                </div>
            </div>
            <!-- SOL SPEEDSTER -->
            <div class="ship-card" onclick="selectShip('SOL')" data-ship="SOL">
                <div class="ship-icon" style="color: #00d2d3;">‚óé</div>
                <h3 style="color: #00d2d3;">SOL SPEEDSTER</h3>
                <div class="ship-trait" style="color: #aaa; font-size: 11px; margin-bottom: 8px;">‚ö° RAPID FIRE</div>
                <div class="stats">
                    <div class="stat-row">
                        <span class="stat-icon">üí®</span>
                        <span class="stat-name">Speed</span>
                        <span class="stat-value" style="color:#00d2d3">‚óè‚óè‚óè‚óè‚óè</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-icon">üí•</span>
                        <span class="stat-name">Damage</span>
                        <span class="stat-value" style="color:#00d2d3">‚óè‚óè‚óã‚óã‚óã</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-icon">üî´</span>
                        <span class="stat-name">Fire Rate</span>
                        <span class="stat-value" style="color:#00d2d3">‚óè‚óè‚óè‚óè‚óè</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-icon">‚≠ï</span>
                        <span class="stat-name">Hitbox</span>
                        <span class="stat-value" style="color:#00d2d3">‚óè‚óè‚óè‚óè‚óè</span>
                    </div>
                </div>
            </div>
        </div>
        <button class="btn btn-primary btn-sm" onclick="backToIntro()">BACK</button>
    </div>

    <!-- PAUSE SCREEN -->
    <div id="pause-screen" style="display: none;">
        <h1 class="neon-title" id="pause-title">PAUSA</h1>
        <button class="btn btn-primary btn-block" id="btn-resume" onclick="togglePause()">‚ü° RIPRENDI</button>
        <button class="btn btn-primary btn-block" id="btn-settings" onclick="toggleSettings()">‚ü° IMPOSTAZIONI</button>
        <button class="btn btn-primary btn-block" id="btn-manual" onclick="toggleManual()">‚ü° MANUALE</button>
        <button class="btn btn-primary btn-block" id="btn-restart" onclick="restartRun()">‚ü° RICOMINCIA</button>
        <button class="btn btn-danger btn-block" id="btn-exit-title" onclick="backToIntro()">‚ü° ESCI</button>
        <div class="menu-row">
            <button class="btn btn-icon-round music-toggle" id="pause-music-toggle">
                <svg viewBox="0 0 24 24" class="icon-svg"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55C7.79 13 6 14.79 6 17s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>
            </button>
            <button class="btn btn-icon-round sfx-toggle" id="pause-sfx-toggle">
                <svg viewBox="0 0 24 24" class="icon-svg"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/></svg>
            </button>
        </div>
    </div>

    <!-- PERK CHOICE MODAL -->
    <div id="perk-modal" style="display: none;">
        <div class="perk-panel terminal-panel">
            <div class="terminal-header-small">UPGRADE OFFER</div>
            <h2 class="neon-title">CHOOSE MODULE</h2>
            <div id="perk-options" class="perk-options"></div>
            <button id="perk-skip" class="btn btn-secondary btn-sm">SKIP</button>
        </div>
    </div>

    <div id="gameover-screen" style="display: none;">
        <h1 class="glitch-text">LIQUIDATION EVENT</h1>
        <p id="gameover-meme" style="color: #6aa9ff; font-family: 'Courier New', monospace; font-size: 16px; margin: 8px 0;">PAPER HANDS</p>
        <p id="roast-msg"
            style="color: #F7931A; font-family: 'Courier New', monospace; font-size: 16px; margin: 10px 0;">ACCOUNT BALANCE</p>
        <div class="final-score"><span id="finalScore">0</span></div>
        <div id="gameover-stats">
            <div>KILLS: <span id="killsVal">0</span></div>
            <div>BEST STREAK: <span id="streakVal">0</span></div>
        </div>
        <div class="gameover-actions">
            <button class="btn btn-primary btn-lg" id="btn-retry" onclick="restartFromGameOver()">RETRY</button>
            <button class="btn btn-secondary" onclick="backToIntro()">MENU</button>
        </div>
    </div>

    <!-- Control zone hint ‚Äî grey area below graze meter -->
    <div id="control-zone-hint"></div>

    <div id="touchControls">
        <div class="touch-zone-left" id="t-left"></div>
        <div class="touch-zone-right" id="t-right"></div>
        <div id="joystick">
            <div id="joystick-base"></div>
            <div id="joystick-stick"></div>
        </div>
        <button id="pause-btn" onclick="togglePause()">II</button>
        <div class="shield-btn-wrapper" id="t-shield">
            <svg class="shield-radial" viewBox="0 0 68 68">
                <circle class="shield-radial-bg" cx="34" cy="34" r="30" />
                <circle class="shield-radial-progress" cx="34" cy="34" r="30" />
            </svg>
            <div class="shield-btn-face">
                <span class="shield-icon">üõ°Ô∏è</span>
            </div>
        </div>
        <!-- v4.0.4: HYPER mode touch button (gold, right side) -->
        <div class="hyper-btn-wrapper" id="t-hyper">
            <svg class="hyper-radial" viewBox="0 0 68 68">
                <circle class="hyper-radial-bg" cx="34" cy="34" r="30" />
                <circle class="hyper-radial-progress" cx="34" cy="34" r="30" />
            </svg>
            <div class="hyper-btn-face">
                <span class="hyper-icon">‚ö°</span>
            </div>
        </div>
    </div>

        <div id="control-toast">CONTROLS: SWIPE</div>

        <!-- MEME POPUP v4.20.0 - Neon cartoon popup above player ship -->
        <div id="meme-popup">
            <div class="meme-box">
                <span class="meme-emoji"></span>
                <span class="meme-text"></span>
            </div>
        </div>

    </div><!-- /game-container -->

    <!-- TUTORIAL OVERLAY (v4.37 unified) - Outside game-container for proper stacking above curtain -->
    <div id="tutorial-overlay" style="display: none;">
        <div class="tutorial-container tutorial-unified">
            <h2 class="tutorial-title" data-i18n="TUT_TITLE">HOW TO PLAY</h2>
            <div class="tutorial-section">
                <div class="desktop-only">
                    <p class="tutorial-text" data-i18n="TUT_CONTROLS_PC">A/D or Arrows to move. Space to fire. S for Shield.</p>
                </div>
                <div class="mobile-only">
                    <p class="tutorial-text" data-i18n="TUT_CONTROLS_UNIFIED">SWIPE LEFT & RIGHT TO MOVE</p>
                </div>
            </div>
            <div class="tutorial-section">
                <p class="tutorial-text" data-i18n="TUT_OBJECTIVE_UNIFIED">Destroy 5 waves, then defeat the Boss!</p>
            </div>
            <div class="tutorial-section">
                <p class="tutorial-text tutorial-tips" data-i18n="TUT_SURVIVAL_UNIFIED">3 lives &#8226; 1 hit = 1 life &#8226; Shield = your defense</p>
            </div>
            <div class="tutorial-actions">
                <button class="btn btn-primary btn-lg" id="tut-go-btn" onclick="completeTutorial()" data-i18n="GO">GO!</button>
            </div>
        </div>
    </div>

    <!-- SETTINGS MODAL - Outside game-container for proper stacking -->
    <div id="settings-modal" style="display: none;">
        <div class="modal-content paper-modal">
            <h2 class="modal-title">IMPOSTAZIONI</h2>

            <!-- Bear Market Toggle -->
            <div class="setting-row setting-bear">
                <span class="setting-label">BEAR MARKET</span>
                <button class="toggle-switch" onclick="toggleBearMode()" id="bear-toggle">
                    <span class="switch-track"></span>
                    <span class="switch-thumb"></span>
                    <span class="switch-label">OFF</span>
                </button>
            </div>

            <div class="setting-row">
                <span class="setting-label">LINGUA</span>
                <button class="btn btn-toggle" onclick="toggleLang()" id="lang-btn">IT</button>
            </div>
            <div class="setting-row">
                <span class="setting-label">CONTROLLI</span>
                <button class="btn btn-toggle" onclick="toggleControlMode()" id="control-btn">SWIPE</button>
            </div>
            <div class="setting-row">
                <span class="setting-label">DEADZONE</span>
                <input type="range" class="slider-cell" id="joy-deadzone" min="0" max="40" value="15">
            </div>
            <div class="setting-row">
                <span class="setting-label">SENSIBILIT√Ä</span>
                <input type="range" class="slider-cell" id="joy-sensitivity" min="50" max="150" value="100">
            </div>

            <div class="how-to-play paper-box">
                <h3>CONTROLLI</h3>
                <p class="desktop-only"><span class="icon-tag">‚å®Ô∏è</span> Frecce = Muovi ‚Ä¢ Spazio = Spara ‚Ä¢ Gi√π = Scudo</p>
                <p class="mobile-only"><span class="icon-tag">üì±</span> Swipe o Joystick = Muovi ‚Ä¢ Icona = Scudo</p>
            </div>

            <button class="btn btn-primary" onclick="toggleHelpPanel()">? HELP</button>
            <button class="btn btn-primary" onclick="toggleCreditsPanel()">CREDITS</button>
            <button class="btn btn-primary" id="btn-settings-close" onclick="toggleSettings()">CHIUDI</button>
        </div>
    </div>

    <!-- CREDITS PANEL -->
    <div id="credits-panel" style="display: none;">
        <div class="modal-content paper-modal credits-modal">
            <h2 class="modal-title">CREDITS</h2>
            <div class="credits-content">
                <p class="credits-author">psychoSocial</p>
                <a href="https://www.psychosoci5l.com/" target="_blank" rel="noopener noreferrer" class="credits-link">www.psychosoci5l.com</a>
            </div>
            <button class="btn btn-primary" onclick="toggleCreditsPanel()">CHIUDI</button>
        </div>
    </div>

    <!-- HELP PANEL - Outside game-container for proper stacking -->
    <div id="help-panel" style="display: none;">
        <div class="modal-content paper-modal help-modal">
            <h2 class="modal-title">COME FARE PUNTI</h2>

            <div class="help-section">
                <h3>üí∞ SCORING</h3>
                <div class="help-item">
                    <span class="help-icon">üíÄ</span>
                    <div class="help-text">
                        <strong>Kill Enemies</strong>
                        <p>Ogni nemico ucciso = punti base (20-100 in base al tipo)</p>
                    </div>
                </div>
                <div class="help-item">
                    <span class="help-icon">üíé</span>
                    <div class="help-text">
                        <strong>HODL Mode (2x Score)</strong>
                        <p>Stai fermo mentre spari = danno e punti doppi!</p>
                    </div>
                </div>
                <div class="help-item">
                    <span class="help-icon">üî•</span>
                    <div class="help-text">
                        <strong>Kill Streak</strong>
                        <p>Uccidi senza farti colpire = bonus crescente!</p>
                    </div>
                </div>
            </div>

            <div class="help-section">
                <h3>‚ú® GRAZING</h3>
                <div class="help-item">
                    <span class="help-icon">üåü</span>
                    <div class="help-text">
                        <strong>Sfiorare i Proiettili</strong>
                        <p>Passa vicino ai proiettili nemici senza farti colpire = GRAZE POINTS + moltiplicatore!</p>
                    </div>
                </div>
                <div class="help-item">
                    <span class="help-icon">üéÅ</span>
                    <div class="help-text">
                        <strong>Graze Bonus</strong>
                        <p>Ogni 50 graze = perk bonus automatico!</p>
                    </div>
                </div>
            </div>

            <div class="help-section">
                <h3>üíÄ SURVIVAL</h3>
                <div class="help-item">
                    <span class="help-icon">‚ù§Ô∏è</span>
                    <div class="help-text">
                        <strong>1 Hit = 1 Life</strong>
                        <p>Un colpo = una vita persa! Hai solo 3 vite totali. Usa lo SCUDO!</p>
                    </div>
                </div>
                <div class="help-item">
                    <span class="help-icon">üí•</span>
                    <div class="help-text">
                        <strong>Bullet Time</strong>
                        <p>Quando vieni colpito, tutti i proiettili esplodono e il tempo rallenta per 2 secondi.</p>
                    </div>
                </div>
            </div>

            <div class="help-section">
                <h3>üéØ HITBOX</h3>
                <div class="help-item">
                    <span class="help-icon">‚≠ï</span>
                    <div class="help-text">
                        <strong>Core Hitbox</strong>
                        <p>Solo il CENTRO della nave prende danno. Il cerchio bianco indica la zona di pericolo.</p>
                    </div>
                </div>
            </div>

            <div class="help-section">
                <h3>‚¨ÜÔ∏è POWER-UPS</h3>
                <div class="help-item">
                    <span class="help-icon">üî±</span>
                    <div class="help-text">
                        <strong>Armi</strong>
                        <p>WIDE (triplo largo) ‚Ä¢ NARROW (triplo stretto) ‚Ä¢ FIRE (penetrante)</p>
                    </div>
                </div>
                <div class="help-item">
                    <span class="help-icon">üöÄ</span>
                    <div class="help-text">
                        <strong>Ship Boost</strong>
                        <p>SPEED (velocit√†) ‚Ä¢ RAPID (fire rate) ‚Ä¢ SHIELD (scudo istantaneo)</p>
                    </div>
                </div>
            </div>

            <div class="help-section">
                <h3>üêª BEAR MARKET</h3>
                <div class="help-item">
                    <span class="help-icon">üìà</span>
                    <div class="help-text">
                        <strong>Hard Mode</strong>
                        <p>Nemici pi√π veloci e aggressivi, ma PUNTI DOPPI!</p>
                    </div>
                </div>
            </div>

            <button class="btn btn-primary" onclick="toggleHelpPanel()">CHIUDI</button>
        </div>
    </div>

    <!-- MANUAL MODAL v2 - Scrollable sections (v4.12.0) -->
    <div id="manual-modal" style="display: none;">
        <div class="manual-container manual-v2">
            <h2 class="manual-title" data-i18n="MANUAL_TITLE">PLAYER MANUAL</h2>

            <div class="manual-scroll">
                <!-- SECTION 1: CONTROLS -->
                <div class="manual-section-v2">
                    <h3 class="section-heading" data-i18n="TAB_CONTROLS">CONTROLS</h3>
                    <div class="desktop-only">
                        <table class="manual-table">
                            <tr><th data-i18n="CTRL_MOVE">Move</th><td data-i18n="CTRL_ARROWS">A/D or Arrow Keys</td></tr>
                            <tr><th data-i18n="CTRL_FIRE">Fire</th><td data-i18n="CTRL_SPACE">Space or Up Arrow</td></tr>
                            <tr><th data-i18n="CTRL_SHIELD">Shield</th><td data-i18n="CTRL_DOWN">S or Down Arrow</td></tr>
                            <tr><th data-i18n="CTRL_PAUSE">Pause</th><td data-i18n="CTRL_ESC">ESC</td></tr>
                        </table>
                    </div>
                    <div class="mobile-only">
                        <table class="manual-table">
                            <tr><th data-i18n="CTRL_MOVE">Move</th><td data-i18n="CTRL_TAP_SIDES">Tap screen sides or joystick</td></tr>
                            <tr><th data-i18n="CTRL_FIRE">Fire</th><td data-i18n="CTRL_AUTO">Automatic while touching</td></tr>
                            <tr><th data-i18n="CTRL_SHIELD">Shield</th><td data-i18n="CTRL_TAP_ICON">Tap shield icon</td></tr>
                        </table>
                    </div>
                </div>

                <!-- SECTION 2: OBJECTIVES -->
                <div class="manual-section-v2">
                    <h3 class="section-heading" data-i18n="MAN_OBJECTIVES">OBJECTIVES</h3>
                    <p class="manual-body" data-i18n="MAN_OBJ_TEXT">Destroy waves of fiat enemies, collect power-ups, survive 5 waves per level, then defeat the Boss. Each cycle increases difficulty and rewards.</p>
                    <p class="manual-body manual-warn" data-i18n="MAN_OBJ_DEATH">1 hit = 1 life lost. 3 lives total. Shield is your only defense!</p>
                </div>

                <!-- SECTION 3: POWER-UPS -->
                <div class="manual-section-v2">
                    <h3 class="section-heading" data-i18n="TAB_POWERUPS">POWER-UPS</h3>
                    <table class="manual-table powerup-table">
                        <tr><td class="pu-icon">‚¨ÜÔ∏è</td><td class="pu-name">UPGRADE</td><td data-i18n="MAN_PU_UPGRADE">Permanent shot level +1 (1‚Üí2‚Üí3)</td></tr>
                        <tr><td class="pu-icon">‚ö°</td><td class="pu-name">RATE</td><td data-i18n="MAN_PU_RATE">Fire rate boost (stacks x3, 12s)</td></tr>
                        <tr><td class="pu-icon">üí•</td><td class="pu-name">POWER</td><td data-i18n="MAN_PU_POWER">Damage boost (stacks x3, 12s)</td></tr>
                        <tr><td class="pu-icon">üî±</td><td class="pu-name">SPREAD</td><td data-i18n="MAN_PU_SPREAD">Wider shot angle (stacks x2, 12s)</td></tr>
                        <tr><td class="pu-icon">üéØ</td><td class="pu-name">HOMING</td><td data-i18n="MAN_PU_HOMING">Auto-tracking bullets (12s)</td></tr>
                        <tr><td class="pu-icon">üî•</td><td class="pu-name">PIERCE</td><td data-i18n="MAN_PU_PIERCE">Penetrating bullets (12s)</td></tr>
                        <tr><td class="pu-icon">‚ö°</td><td class="pu-name">LASER</td><td data-i18n="MAN_PU_LASER">Continuous beam (12s)</td></tr>
                        <tr><td class="pu-icon">üöÄ</td><td class="pu-name">MISSILE</td><td data-i18n="MAN_PU_MISSILE">AoE explosive shots (12s)</td></tr>
                        <tr><td class="pu-icon">üõ°Ô∏è</td><td class="pu-name">SHIELD</td><td data-i18n="MAN_PU_SHIELD">Instant shield activation</td></tr>
                        <tr><td class="pu-icon">üí®</td><td class="pu-name">SPEED</td><td data-i18n="MAN_PU_SPEED">Movement speed +50% (12s)</td></tr>
                    </table>
                    <p class="section-note warning" data-i18n="POWERUPS_DEATH">On Death: -1 level per category (min 0), specials lost</p>
                </div>

                <!-- SECTION 4: TIPS -->
                <div class="manual-section-v2">
                    <h3 class="section-heading" data-i18n="TAB_TIPS">PRO TIPS</h3>
                    <div class="tip-compact">
                        <p data-i18n="MAN_TIP_HODL">üíé <strong>HODL</strong> ‚Äî Stop moving = 2x damage + golden aura</p>
                        <p data-i18n="MAN_TIP_GRAZE">üî• <strong>GRAZE</strong> ‚Äî Dodge close to bullets = score multiplier (up to 2.5x)</p>
                        <p data-i18n="MAN_TIP_SHIELD">üõ°Ô∏è <strong>SHIELD</strong> ‚Äî 10s cooldown. Your only defense against hits!</p>
                        <p data-i18n="MAN_TIP_BOSS">‚ö° <strong>BOSSES</strong> ‚Äî 3 phases each. Every 25 hits drops a power-up</p>
                        <p data-i18n="MAN_TIP_BEAR">üêª <strong>BEAR MARKET</strong> ‚Äî Hard mode in Settings. Double points!</p>
                    </div>
                </div>
            </div>

            <button class="btn btn-primary manual-close" onclick="toggleManual()" data-i18n="CLOSE">CLOSE</button>
        </div>
    </div>

    <!-- Ordered Scripts for file:// compatibility (Namespace Pattern) -->
    <script src="src/utils/Constants.js"></script>
    <script src="src/utils/DebugSystem.js"></script>
    <script src="src/utils/ColorUtils.js"></script>
    <script src="src/utils/MathUtils.js"></script>
    <script src="src/config/BalanceConfig.js"></script>
    <script src="src/audio/MusicData.js"></script>
    <script src="src/systems/BulletPatterns.js"></script>
    <script src="src/systems/BulletSystem.js"></script>
    <script src="src/systems/CollisionSystem.js"></script>
    <script src="src/systems/DropSystem.js"></script>
    <script src="src/systems/MemeEngine.js"></script>
    <script src="src/core/EventBus.js"></script>
    <script src="src/core/GameStateMachine.js"></script>
    <script src="src/systems/HarmonicSequences.js"></script>
    <script src="src/systems/HarmonicConductor.js"></script>
    <script src="src/utils/RunState.js"></script>
    <script src="src/systems/RankSystem.js"></script>
    <script src="src/utils/Upgrades.js"></script>
    <script src="src/core/AudioSystem.js"></script>
    <script src="src/core/InputSystem.js"></script>
    <script src="src/core/ObjectPool.js"></script>
    <script src="src/systems/ParticleSystem.js"></script>
    <script src="src/systems/EffectsRenderer.js"></script>
    <script src="src/systems/SkyRenderer.js"></script>
    <script src="src/systems/TransitionManager.js"></script>
    <script src="src/systems/TitleAnimator.js"></script>
    <script src="src/systems/MessageSystem.js"></script>
    <script src="src/entities/Entity.js"></script>
    <script src="src/entities/Bullet.js"></script>
    <script src="src/entities/Player.js"></script>
    <script src="src/entities/Enemy.js"></script>
    <script src="src/entities/Boss.js"></script>
    <script src="src/entities/PowerUp.js"></script>
    <script src="src/managers/WaveManager.js"></script>
    <script src="src/managers/CampaignState.js"></script>
    <!-- Story System -->
    <script src="src/story/StoryScreenData.js"></script>
    <script src="src/story/StoryScreen.js"></script>
    <script src="src/story/DialogueData.js"></script>
    <script src="src/story/StoryManager.js"></script>
    <script src="src/story/DialogueUI.js"></script>
    <script type="module" src="src/main.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW Registered!', reg.scope))
                    .catch(err => console.log('SW Failed:', err));
            });
        }
    </script>
</body>

</html>
