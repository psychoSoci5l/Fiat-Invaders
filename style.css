:root {
    --neon-violet: #bb44ff;
    --neon-blue: #00f0ff;
    --neon-green: #39ff14;
    --neon-magenta: #ff2d95;
    --neon-cyan: #00f0ff;
    --bg-color: #030308;
    --terminal-bg: rgba(4, 4, 16, 0.8);
    --terminal-border: rgba(0, 240, 255, 0.35);
    --terminal-glow: rgba(0, 240, 255, 0.25);
    /* Button Design System */
    --btn-violet-border: #bb44ff;
    --btn-violet-glow: rgba(187, 68, 255, 0.4);
    --btn-violet-fill: rgba(187, 68, 255, 0.08);
    --btn-violet-hover: rgba(187, 68, 255, 0.18);
    --btn-danger-top: #ff2d95;
    --btn-danger-bottom: #cc2277;
    --btn-danger-shadow: #881155;
}

/* ======== BUTTON DESIGN SYSTEM ======== */

/* Base button reset */
.btn {
    font-family: inherit;
    font-weight: 900;
    letter-spacing: 2px;
    text-transform: uppercase;
    cursor: pointer;
    border: none;
    outline: none;
    -webkit-tap-highlight-color: transparent;
    transition: transform 0.15s, box-shadow 0.15s;
    position: relative;
    display: inline-flex;
    justify-content: center;
    align-items: center;
    text-decoration: none;
    line-height: 1.2;
}

.btn:focus-visible {
    outline: 2px solid #fff;
    outline-offset: 3px;
}

/* Primary — Neon violet outline */
.btn-primary {
    background: var(--btn-violet-fill);
    border: 2px solid var(--btn-violet-border);
    color: #fff;
    border-radius: 8px;
    padding: 14px 36px;
    font-size: 16px;
    box-shadow: 0 0 15px var(--btn-violet-glow), inset 0 1px 0 rgba(255,255,255,0.05);
    text-shadow: 0 0 8px rgba(187, 68, 255, 0.5);
}

.btn-primary:hover {
    background: var(--btn-violet-hover);
    box-shadow: 0 0 25px var(--btn-violet-glow), 0 0 40px rgba(187, 68, 255, 0.2);
    transform: translateY(-2px);
}

.btn-primary:active {
    transform: translateY(1px);
    box-shadow: 0 0 10px var(--btn-violet-glow);
}

/* Secondary — Ghost */
.btn-secondary {
    background: transparent;
    border: 2px solid rgba(255, 255, 255, 0.3);
    color: rgba(255, 255, 255, 0.6);
    border-radius: 8px;
    padding: 14px 36px;
    font-size: 16px;
}

.btn-secondary:hover {
    border-color: rgba(255, 255, 255, 0.5);
    color: #fff;
    background: rgba(255, 255, 255, 0.05);
}

.btn-secondary:active {
    transform: translateY(2px);
}

/* Danger — Red gradient (ESCI) */
.btn-danger {
    background: linear-gradient(180deg, var(--btn-danger-top), var(--btn-danger-bottom));
    border: 3px solid #000;
    color: #fff;
    border-radius: 8px;
    padding: 14px 36px;
    font-size: 16px;
    font-weight: 900;
    box-shadow: 0 4px 0 var(--btn-danger-shadow), 0 0 15px rgba(255, 45, 149, 0.3);
}

.btn-danger:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 0 var(--btn-danger-shadow), 0 0 25px rgba(255, 45, 149, 0.5);
    background: linear-gradient(180deg, #ff6b5a, var(--btn-danger-top));
}

.btn-danger:active {
    transform: translateY(2px);
    box-shadow: 0 2px 0 var(--btn-danger-shadow);
}

/* Toggle — Compact violet outline (lingua/controlli) */
.btn-toggle {
    background: var(--btn-violet-fill);
    color: #fff;
    border: 2px solid var(--btn-violet-border);
    border-radius: 6px;
    padding: 8px 20px;
    font-size: 14px;
    font-weight: 900;
    box-shadow: 0 0 10px var(--btn-violet-glow);
}

.btn-toggle:hover {
    transform: translateY(-2px);
    box-shadow: 0 0 20px var(--btn-violet-glow);
    background: var(--btn-violet-hover);
}

.btn-toggle:active {
    transform: translateY(2px);
    box-shadow: 0 0 6px var(--btn-violet-glow);
}

/* Icon — 44x44 square violet (intro icons) */
.btn-icon {
    width: 44px;
    height: 44px;
    padding: 0;
    background: linear-gradient(180deg, #9944cc, #7722aa);
    border: 2px solid #bb44ff;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(187,68,255,0.3);
}

.btn-icon:hover {
    transform: translateY(-2px);
    box-shadow: 0 0 20px rgba(187,68,255,0.5);
    background: linear-gradient(180deg, #aa55dd, #9944cc);
}

.btn-icon:active {
    transform: translateY(2px);
    box-shadow: 0 0 6px rgba(187,68,255,0.2);
}

.btn-icon .icon-svg {
    width: 24px;
    height: 24px;
    fill: #fff;
    transition: fill 0.15s;
}

.btn-icon:hover .icon-svg {
    fill: #eee;
}

.btn-icon.muted .icon-svg {
    fill: #cc2277;
}

/* Music/SFX toggle — muted state for both btn-icon and btn-icon-round */
.music-toggle.muted,
.sfx-toggle.muted {
    background: linear-gradient(180deg, #555, #333);
    border-color: #cc2277;
}

.music-toggle.muted .icon-svg,
.sfx-toggle.muted .icon-svg {
    fill: #cc2277;
}

/* Icon Round — 50px circular violet (pause mute) */
.btn-icon-round {
    width: 50px;
    height: 50px;
    padding: 0;
    font-size: 24px;
    background: linear-gradient(180deg, #9944cc, #7722aa);
    border: 2px solid #bb44ff;
    border-radius: 50%;
    box-shadow: 0 0 10px rgba(187,68,255,0.3);
}

.btn-icon-round:hover {
    transform: translateY(-2px);
    box-shadow: 0 0 20px rgba(187,68,255,0.5);
}

.btn-icon-round:active {
    transform: translateY(2px);
    box-shadow: 0 0 6px rgba(187,68,255,0.2);
}

.btn-icon-round .icon-svg {
    width: 24px;
    height: 24px;
    fill: #fff;
    pointer-events: none;
}

/* Size modifiers */
.btn-sm {
    padding: 10px 24px;
    font-size: 14px;
}

.btn-lg {
    padding: 18px 40px;
    font-size: 18px;
    letter-spacing: 3px;
}

/* Block — Full width */
.btn-block {
    width: min(320px, 85vw);
    display: flex;
}

/* CTA — Title action with pulse + shine */
.btn-cta {
    width: 100%;
    padding: 18px 30px;
    font-size: clamp(18px, 5vw, 24px);
    letter-spacing: 5px;
    border-radius: 12px;
    /* Default: TAP TO START ghost style */
    background: linear-gradient(180deg, rgba(187, 68, 255, 0.15), rgba(187, 68, 255, 0.05));
    border: 3px solid var(--neon-violet);
    color: var(--neon-violet);
    text-shadow: 0 0 15px rgba(187, 68, 255, 0.6), 0 2px 4px rgba(0, 0, 0, 0.5);
    box-shadow: 0 0 20px rgba(187, 68, 255, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1), 0 4px 0 rgba(0, 0, 0, 0.3);
    animation: tapPulse 2.5s ease-in-out infinite;
    overflow: hidden;
}

.btn-cta::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    animation: tapShine 3s ease-in-out infinite;
    will-change: transform;
}

.btn-cta:hover {
    background: linear-gradient(180deg, rgba(187, 68, 255, 0.3), rgba(187, 68, 255, 0.15));
    transform: translateY(-3px);
    box-shadow: 0 0 40px rgba(187, 68, 255, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.2), 0 8px 0 rgba(0, 0, 0, 0.3);
}

.btn-cta:active {
    transform: translateY(2px);
    box-shadow: 0 0 20px rgba(187, 68, 255, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1), 0 2px 0 rgba(0, 0, 0, 0.3);
}

/* CTA LAUNCH state — solid violet */
.btn-cta.launch-state {
    background: linear-gradient(180deg, #cc55ff, #9933dd);
    border: 3px solid #bb44ff;
    color: #fff;
    text-shadow: 0 0 8px rgba(187, 68, 255, 0.5);
    box-shadow: 0 0 25px rgba(187, 68, 255, 0.5), 0 4px 0 rgba(0, 0, 0, 0.3);
    animation: none;
}

.btn-cta.launch-state::before {
    animation: none;
    display: none;
}

.btn-cta.launch-state:hover {
    transform: translateY(-3px);
    box-shadow: 0 0 40px rgba(187, 68, 255, 0.7), 0 8px 0 rgba(0, 0, 0, 0.3);
    background: linear-gradient(180deg, #dd66ff, #cc55ff);
}

.btn-cta.launch-state:active {
    transform: translateY(3px);
    box-shadow: 0 0 15px rgba(187, 68, 255, 0.4);
}

/* PWA install banner button */
.btn-pwa {
    background: #bb44ff;
    color: #fff;
    border: none;
    border-radius: 6px;
    padding: 8px 14px;
    font-size: 12px;
    font-weight: 700;
    letter-spacing: 1px;
    white-space: nowrap;
}

.btn-pwa:active {
    background: #9933dd;
    transform: scale(0.95);
}

/* Tutorial flex fix */
.tutorial-actions .btn {
    flex: 1;
    min-height: 48px;
}

/* iframe embedding support */
html, body {
    width: 100%;
    height: 100%;
    overflow: hidden;
}

body {
    margin: 0;
    padding: 0;
    background: var(--bg-color);
    font-family: Consolas, "Courier New", monospace;
    touch-action: none;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    user-select: none;
    -webkit-user-select: none;
    -webkit-touch-callout: none;
    -webkit-tap-highlight-color: transparent;
    /* Removed Padding from Body to allow Fullscreen Canvas */
}

/* Game Container: adapts to safe areas in Safari, fullscreen in PWA */
#game-container {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    max-width: 600px;
    width: 100%;
    overflow: hidden;
    background: #000;
    -webkit-tap-highlight-color: transparent;
    /* Dimensions and position set by JS resize() */
}

/* Main game canvas only */
#gameCanvas {
    display: block;
    width: 100%;
    height: 100%;
    background: #000;
}

/* Intro ship canvases - transparent */
#splash-ship-canvas,
#intro-ship-canvas {
    display: block;
    background: transparent !important;
}

/* EFFECTS */
.scanlines {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
    background-size: 100% 2px, 3px 100%;
    pointer-events: none;
    z-index: 100;
}

.vignette {
    display: none; /* Disabled for sharper visuals */
}

/* --- UI LAYOUT: COCKPIT MODULES (FIXED) --- */
#ui-layer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 120;
    /* ABOVE Scanlines (100) and Vignette (90) */
    display: flex;
    justify-content: space-between;
    /* Moduli ai lati */
    align-items: flex-start;
    /* CRUCIALE: Impedisce lo stretching verticale */
    padding: 20px;
    box-sizing: border-box;
    /* Safe areas now handled by game-container */
}

/* IL MODULO GRAFICO */
/* === COMPACT HUD v4.4 - Single row 45px === */
.hud-top-bar {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    padding: calc(8px + var(--pwa-top-inset, env(safe-area-inset-top, 0px))) 12px 4px 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-sizing: border-box;
    z-index: 100;
    pointer-events: none;
    height: calc(45px + var(--pwa-top-inset, env(safe-area-inset-top, 0px)));
}

/* Lives: heart icon + number */
.hud-lives {
    display: flex;
    align-items: center;
    gap: 4px;
    min-width: 50px;
}

.hud-heart {
    color: #ff2d95;
    font-size: 18px;
    text-shadow: 0 0 6px rgba(255, 45, 149, 0.6);
}

.hud-lives #livesText {
    font-size: 20px;
    font-weight: 900;
    color: #fff;
    text-shadow: 0 0 5px rgba(255, 255, 255, 0.5),
        -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
}

/* Score: centered, reduced size */
.hud-score-compact {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
}

.hud-score-value {
    font-size: 36px;
    font-weight: 900;
    color: #ffaa00;
    text-shadow:
        0 0 8px #ffaa00,
        0 0 16px #ffaa00,
        0 0 30px rgba(255, 170, 0, 0.4),
        0 2px 0 #885500;
    letter-spacing: 1px;
    animation: scorePulse 0.5s ease-in-out infinite alternate;
}

@keyframes scorePulse {
    0% { text-shadow: 0 0 8px #ffaa00, 0 0 16px #ffaa00, 0 0 30px rgba(255, 170, 0, 0.4), 0 2px 0 #885500; }
    100% { text-shadow: 0 0 12px #ffaa00, 0 0 24px #ffaa00, 0 0 45px rgba(255, 170, 0, 0.6), 0 2px 0 #885500; }
}

/* v5.14: Score Pulse Tiers — 4 tier animations replace single scoreBump */
.hud-score-value.score-normal {
    animation: scorePulseNormal 0.2s ease-out;
}
.hud-score-value.score-big {
    animation: scorePulseBig 0.3s ease-out;
}
.hud-score-value.score-massive {
    animation: scorePulseMassive 0.4s ease-out;
}
.hud-score-value.score-legendary {
    animation: scorePulseLegendary 0.5s ease-out;
}

@keyframes scorePulseNormal {
    0%   { transform: scale(1); }
    40%  { transform: scale(1.15); color: #fff; text-shadow: 0 0 6px rgba(255,255,255,0.3); }
    100% { transform: scale(1); }
}

@keyframes scorePulseBig {
    0%   { transform: scale(1) translateX(0); }
    30%  { transform: scale(1.3) translateX(2px); color: #ffaa00; text-shadow: 0 0 12px rgba(255,170,0,0.6), 0 0 24px rgba(255,170,0,0.3); }
    60%  { transform: scale(1.1) translateX(-1px); }
    100% { transform: scale(1) translateX(0); }
}

@keyframes scorePulseMassive {
    0%   { transform: scale(1) translateX(0); }
    20%  { transform: scale(1.5) translateX(-4px); color: #ff6600; text-shadow: 0 0 16px rgba(255,102,0,0.8), 0 0 32px rgba(255,102,0,0.4); }
    40%  { transform: scale(1.2) translateX(3px); }
    60%  { transform: scale(1.1) translateX(-2px); }
    100% { transform: scale(1) translateX(0); }
}

@keyframes scorePulseLegendary {
    0%   { transform: scale(1) translateX(0); }
    15%  { transform: scale(1.8) translateX(6px); color: #ff3300; text-shadow: 0 0 20px rgba(255,51,0,1), 0 0 40px rgba(255,170,0,0.6), 0 0 60px rgba(255,51,0,0.3); }
    30%  { transform: scale(1.4) translateX(-4px); color: #ffaa00; }
    50%  { transform: scale(1.2) translateX(3px); }
    70%  { transform: scale(1.1) translateX(-1px); }
    100% { transform: scale(1) translateX(0); }
}

/* v5.14: New High Score — persistent glow after beating record */
.hud-score-value.score-new-record {
    color: #ff2d95;
    text-shadow:
        0 0 8px #ff2d95,
        0 0 16px #ff2d95,
        0 0 30px rgba(255, 45, 149, 0.4),
        0 2px 0 #882255;
    animation: scoreNewRecordPulse 0.8s ease-in-out infinite alternate;
}

@keyframes scoreNewRecordPulse {
    0% { text-shadow: 0 0 8px #ff2d95, 0 0 16px #ff2d95, 0 0 30px rgba(255,45,149,0.4), 0 2px 0 #882255; }
    100% { text-shadow: 0 0 14px #ff2d95, 0 0 28px #ff2d95, 0 0 50px rgba(255,45,149,0.6), 0 2px 0 #882255; }
}

/* One-shot flash when record is broken */
.hud-score-value.score-record-break {
    animation: scoreRecordBreak 0.6s ease-out !important;
}

@keyframes scoreRecordBreak {
    0%   { transform: scale(1); }
    20%  { transform: scale(2.0); color: #fff; text-shadow: 0 0 30px #fff, 0 0 60px #ff2d95, 0 0 90px rgba(255,45,149,0.5); }
    50%  { transform: scale(1.4); color: #ff2d95; }
    100% { transform: scale(1); }
}

/* Level: right side, inline "LV X" */
.hud-level {
    display: flex;
    align-items: center;
    min-width: 50px;
    justify-content: flex-end;
}

.hud-level::before {
    content: 'LV';
    font-size: 10px;
    font-weight: 700;
    color: rgba(255, 255, 255, 0.6);
    letter-spacing: 1px;
    margin-right: 4px;
    text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
}

.hud-level #lvlVal {
    font-size: 20px;
    font-weight: 900;
    color: #00ff66;
    text-shadow: 0 0 8px rgba(46, 204, 113, 0.5),
        -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
}

/* Lives shake when hit */
.lives-shake {
    animation: livesShake 0.4s ease-out;
}

@keyframes livesShake {
    0%, 100% { transform: translateX(0); }
    10% { transform: translateX(-8px) rotate(-5deg); }
    20% { transform: translateX(8px) rotate(5deg); }
    30% { transform: translateX(-6px) rotate(-3deg); }
    40% { transform: translateX(6px) rotate(3deg); }
    50% { transform: translateX(-4px); }
    60% { transform: translateX(4px); }
    70% { transform: translateX(-2px); }
    80% { transform: translateX(2px); }
}

/* Level up glow effect */
.level-up {
    animation: levelUpGlow 0.6s ease-out;
}

@keyframes levelUpGlow {
    0% { transform: scale(1); text-shadow: 0 0 5px #00ff66; }
    30% { transform: scale(1.3); text-shadow: 0 0 20px #00ff66, 0 0 40px #00cc55; color: #00ff66; }
    100% { transform: scale(1); text-shadow: none; }
}

/* === REACTIVE HUD v4.4 === */

/* Score color during streak milestones */
.score-streak-10 .hud-score-value { color: #00FF00 !important; text-shadow: 0 0 15px #00FF00 !important; }
.score-streak-25 .hud-score-value { color: #FFD700 !important; text-shadow: 0 0 15px #FFD700 !important; }
.score-streak-50 .hud-score-value { color: #FF4444 !important; text-shadow: 0 0 15px #FF4444 !important; }

/* Score during HYPER */
.score-hyper .hud-score-value {
    color: #FFD700 !important;
    text-shadow: 0 0 20px #FFD700, 0 0 40px rgba(255, 215, 0, 0.8) !important;
    animation: hyperScorePulse 0.3s ease-in-out infinite alternate !important;
}

@keyframes hyperScorePulse {
    0% { text-shadow: 0 0 15px #FFD700, 0 0 30px rgba(255, 215, 0, 0.6); }
    100% { text-shadow: 0 0 25px #FFD700, 0 0 50px rgba(255, 215, 0, 0.9); }
}

/* Lives danger state (1 life left) */
.lives-danger .hud-heart,
.lives-danger #livesText {
    color: #FF4444 !important;
    animation: livesDangerPulse 0.6s ease-in-out infinite;
}

@keyframes livesDangerPulse {
    0%, 100% { opacity: 1; text-shadow: 0 0 5px rgba(255, 68, 68, 0.5); }
    50% { opacity: 0.7; text-shadow: 0 0 15px rgba(255, 68, 68, 0.9); }
}

/* Graze meter approaching (faster shimmer) */
#graze-meter.graze-approaching #graze-fill {
    animation: grazeShimmer 0.8s linear infinite;
}

/* Cleaned up Bottom Bar styles */

.bar-container {
    width: 100px;
    height: 8px;
    background: #111;
    border: 1px solid #444;
    border-radius: 4px;
    overflow: hidden;
    position: relative;
    margin-top: 5px;
    /* Spacing from value */
}

.shield-container {
    border-color: #00ffff;
    display: none; /* Hidden - replaced by weapon icon */
}

.health-container {
    border-color: #00ff00;
}

#healthBar,
#shieldBar {
    width: 100%;
    height: 100%;
    transition: width 0.2s;
}

#healthBar {
    background: var(--neon-green);
    box-shadow: 0 0 5px var(--neon-green);
}

#shieldBar {
    width: 100%;
    height: 100%;
    background: var(--neon-blue);
    box-shadow: 0 0 10px var(--neon-blue);
    transition: width 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

/* --- CURTAIN EFFECT --- */
#curtain-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9000;
    pointer-events: none;
    display: flex;
    flex-direction: row;
}

.curtain-left,
.curtain-right {
    width: 50%;
    height: 100%;
    background: #000000;
    transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
}

.curtain-left {
    /* Left panel */
    transform: translateX(0);
    border-right: 2px solid #ff2d95;
    box-shadow: 5px 0 30px rgba(255, 45, 149, 0.4);
}

.curtain-right {
    /* Right panel */
    transform: translateX(0);
    border-left: 2px solid #ff2d95;
    box-shadow: -5px 0 30px rgba(255, 45, 149, 0.4);
}

/* Curtain decorative lines */
.curtain-left::after,
.curtain-right::after {
    content: '';
    position: absolute;
    top: 0;
    width: 2px;
    height: 100%;
    background: linear-gradient(180deg, transparent, #ff2d95, transparent);
    opacity: 0.5;
}

.curtain-left::after {
    right: 20px;
}

.curtain-right::after {
    left: 20px;
}

/* Curtain OPEN state - panels move away to sides */
#curtain-overlay.open .curtain-left {
    transform: translateX(-100%);
}

#curtain-overlay.open .curtain-right {
    transform: translateX(100%);
}

/* Curtain CLOSED state - panels meet at center */
#curtain-overlay.closed .curtain-left {
    transform: translateX(0);
}

#curtain-overlay.closed .curtain-right {
    transform: translateX(0);
}

/* --- VIDEO SPLASH --- */
#splash-layer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #000;
    z-index: 9999;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: opacity 1s ease;
}

#intro-video {
    width: 100%;
    height: 100%;
    object-fit: contain;
    max-width: 800px;
}

/* --- SCREENS --- */
/* --- INTRO SCREEN OVERHAUL --- */
#intro-screen {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    box-sizing: border-box;
    background: transparent;
    /* Show the Sky! */
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    padding-top: 12%;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    z-index: 250; /* v4.21: Above all game elements (touchControls=200, ui-layer=120) */
}

#gameover-screen {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    /* Dark overlay over game */
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 110;
    padding: 40px;
    padding-top: 60px;
    box-sizing: border-box;
    /* Safe areas now handled by game-container */
}

/* === NEW START SCREEN === */
.start-header {
    text-align: center;
    margin-bottom: 10px;
    flex-shrink: 0;
}

.game-title {
    font-size: clamp(48px, 11vw, 72px);
    font-weight: 900;
    line-height: 1.1;
    color: #fff;
    margin: 0;
    letter-spacing: -2px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0;
}

/* FIAT - Enemy red, menacing */
.title-fiat {
    color: #ff2d95;
    text-shadow:
        0 0 10px #ff2d95,
        0 0 20px #cc2277,
        0 0 40px rgba(255, 45, 149, 0.6),
        -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000;
    animation: fiatPulse 2s ease-in-out infinite;
}

/* vs - Small, electric, battle connector */
.title-vs {
    font-size: 0.4em;
    color: #fff;
    letter-spacing: 4px;
    margin: -5px 0;
    text-shadow:
        0 0 5px #fff,
        0 0 15px #00f0ff,
        0 0 25px #00f0ff;
    animation: vsBattle 1.5s ease-in-out infinite;
}

/* CRYPTO - Neon cyan, triumphant */
.title-crypto {
    color: #00f0ff;
    text-shadow:
        0 0 10px #00f0ff,
        0 0 30px #00f0ff,
        0 0 50px rgba(0, 240, 255, 0.7),
        0 0 80px rgba(0, 240, 255, 0.4),
        -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000;
    animation: cryptoGlow 2s ease-in-out infinite;
}

/* FIAT pulse - threatening magenta */
@keyframes fiatPulse {
    0%, 100% {
        text-shadow: 0 0 10px #ff2d95, 0 0 20px #cc2277, 0 0 40px rgba(255, 45, 149, 0.6),
            -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000;
        transform: scale(1);
    }
    50% {
        text-shadow: 0 0 15px #ff2d95, 0 0 30px #cc2277, 0 0 60px rgba(255, 45, 149, 0.8),
            -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000;
        transform: scale(1.02);
    }
}

/* VS battle flash */
@keyframes vsBattle {
    0%, 100% {
        text-shadow: 0 0 5px #fff, 0 0 15px #00f0ff, 0 0 25px #00f0ff;
        opacity: 0.9;
    }
    50% {
        text-shadow: 0 0 10px #fff, 0 0 25px #ff2d95, 0 0 35px #00f0ff;
        opacity: 1;
    }
}

/* CRYPTO glow - neon cyan */
@keyframes cryptoGlow {
    0%, 100% {
        text-shadow: 0 0 10px #00f0ff, 0 0 30px #00f0ff, 0 0 50px rgba(0, 240, 255, 0.7), 0 0 80px rgba(0, 240, 255, 0.4),
            -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000;
        transform: scale(1);
    }
    50% {
        text-shadow: 0 0 15px #00f0ff, 0 0 40px #00f0ff, 0 0 70px rgba(0, 240, 255, 0.9), 0 0 100px rgba(0, 240, 255, 0.5),
            -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000;
        transform: scale(1.03);
    }
}

/* ========== TITLE ANIMATION v4.35 ========== */

/* Subtitle above title */
.title-subtitle {
    display: block;
    font-size: 0.25em;
    letter-spacing: 6px;
    color: rgba(255, 255, 255, 0.6);
    text-shadow: none;
    opacity: 0;
    transition: opacity 0.4s ease;
    text-transform: uppercase;
    margin-bottom: 4px;
}
.title-subtitle.anim-visible {
    opacity: 1;
}

/* Hide title spans during animation sequence */
.intro-title.anim-active .title-fiat,
.intro-title.anim-active .title-vs,
.intro-title.anim-active .title-crypto {
    opacity: 0;
    animation: none !important;
}

/* Animation classes applied by TitleAnimator */
.intro-title.anim-active .title-fiat.anim-bounce-in-top {
    opacity: 1;
    animation: titleBounceInTop 0.55s cubic-bezier(0.22, 1.6, 0.36, 1) forwards !important;
}
.intro-title.anim-active .title-vs.anim-fade-rotate {
    opacity: 1;
    animation: titleFadeRotate 0.4s ease-out forwards !important;
}
.intro-title.anim-active .title-crypto.anim-bounce-in-bottom {
    opacity: 1;
    animation: titleBounceInBottom 0.55s cubic-bezier(0.22, 1.6, 0.36, 1) forwards !important;
}

@keyframes titleBounceInTop {
    0% { transform: translateY(-160px) scale(0.3); opacity: 0; }
    45% { transform: translateY(14px) scale(1.12); opacity: 1; }
    65% { transform: translateY(-8px) scale(0.95); }
    82% { transform: translateY(3px) scale(1.03); }
    100% { transform: translateY(0) scale(1); opacity: 1; }
}
@keyframes titleFadeRotate {
    0% { transform: rotate(-20deg) scale(0.4); opacity: 0; }
    60% { transform: rotate(3deg) scale(1.05); opacity: 1; }
    100% { transform: rotate(0deg) scale(1); opacity: 1; }
}
@keyframes titleBounceInBottom {
    0% { transform: translateY(160px) scale(0.3); opacity: 0; }
    45% { transform: translateY(-14px) scale(1.12); opacity: 1; }
    65% { transform: translateY(8px) scale(0.95); }
    82% { transform: translateY(-3px) scale(1.03); }
    100% { transform: translateY(0) scale(1); opacity: 1; }
}

/* Fade in/out for controls during title animation */
.anim-hidden {
    opacity: 0 !important;
    pointer-events: none !important;
    transition: opacity 0.3s ease !important;
}
.anim-show {
    transition: opacity 0.5s ease;
}

/* Reduced motion: skip all title animations */
@media (prefers-reduced-motion: reduce) {
    .intro-title.anim-active .title-fiat,
    .intro-title.anim-active .title-vs,
    .intro-title.anim-active .title-crypto {
        animation: none !important;
        opacity: 1 !important;
    }
    .title-subtitle {
        opacity: 1 !important;
        transition: none !important;
    }
    .anim-hidden {
        opacity: 1 !important;
        pointer-events: auto !important;
        transition: none !important;
    }
}

/* ========== UNIFIED INTRO SCREEN ========== */

/* Title */
.intro-title {
    font-size: clamp(58px, 13vw, 84px);
    text-align: center;
    margin-bottom: 15px;
    transition: all 0.4s ease;
}

.intro-title.hidden {
    opacity: 0;
    transform: translateY(-20px);
    pointer-events: none;
    position: absolute;
}

/* Selection header */
.selection-header {
    font-size: clamp(20px, 5vw, 26px);
    font-weight: 700;
    letter-spacing: 5px;
    color: #fff;
    text-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
    margin-bottom: 10px;
    animation: fadeSlideDown 0.4s ease-out;
}

@keyframes fadeSlideDown {
    from { opacity: 0; transform: translateY(-15px); }
    to { opacity: 1; transform: translateY(0); }
}

/* TAP TO START button */
.btn-tap-start {
    background: linear-gradient(180deg, rgba(187, 68, 255, 0.15) 0%, rgba(187, 68, 255, 0.05) 100%);
    border: 3px solid var(--neon-violet);
    color: var(--neon-violet);
    font-size: clamp(20px, 6vw, 28px);
    font-weight: 900;
    letter-spacing: 6px;
    padding: 20px 60px;
    cursor: pointer;
    border-radius: 12px;
    animation: tapPulse 2.5s ease-in-out infinite;
    transition: all 0.3s ease;
    text-shadow: 0 0 15px rgba(187, 68, 255, 0.6), 0 2px 4px rgba(0,0,0,0.5);
    box-shadow:
        0 0 20px rgba(187, 68, 255, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.1),
        0 4px 0 rgba(0, 0, 0, 0.3);
    position: relative;
    overflow: hidden;
}

.btn-tap-start.hidden {
    opacity: 0;
    transform: scale(0.9);
    pointer-events: none;
    position: absolute;
}

.btn-tap-start::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    animation: tapShine 3s ease-in-out infinite;
    will-change: transform;
}

@keyframes tapShine {
    0%, 100% { transform: translateX(-200%); }
    50% { transform: translateX(200%); }
}

.btn-tap-start:hover {
    background: linear-gradient(180deg, rgba(187, 68, 255, 0.3) 0%, rgba(187, 68, 255, 0.15) 100%);
    transform: translateY(-3px) scale(1.02);
    box-shadow:
        0 0 40px rgba(187, 68, 255, 0.5),
        inset 0 1px 0 rgba(255, 255, 255, 0.2),
        0 8px 0 rgba(0, 0, 0, 0.3);
}

@keyframes tapPulse {
    0%, 100% {
        border-color: var(--neon-violet);
        text-shadow: 0 0 15px rgba(187, 68, 255, 0.6), 0 2px 4px rgba(0,0,0,0.5);
    }
    50% {
        border-color: #ffb84d;
        text-shadow: 0 0 25px rgba(187, 68, 255, 0.9), 0 0 40px rgba(187, 68, 255, 0.4), 0 2px 4px rgba(0,0,0,0.5);
    }
}

/* Selection controls container */
.selection-controls {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    animation: fadeSlideUp 0.4s ease-out;
}

/* Bottom icons */
.intro-icons {
    position: absolute;
    bottom: calc(50px + var(--pwa-bottom-inset, env(safe-area-inset-bottom, 0px)));
    display: flex;
    gap: 20px;
}

.intro-version {
    position: absolute;
    bottom: calc(20px + var(--pwa-bottom-inset, env(safe-area-inset-bottom, 0px)));
    font-size: 14px;
    color: rgba(255, 255, 255, 0.85);
    letter-spacing: 3px;
    padding: 4px 12px;
    border-radius: 8px;
    background: rgba(0, 0, 0, 0.35);
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
}

.selection-header {
    font-size: clamp(20px, 5vw, 26px);
    font-weight: 700;
    letter-spacing: 5px;
    color: #fff;
    text-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
}

.selection-score {
    text-align: center;
    order: 1; /* Keep at top */
}

.selection-score .score-label {
    font-size: 13px;
    color: rgba(255, 255, 255, 0.7);
    letter-spacing: 3px;
    display: block;
    margin-bottom: 5px;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.4);
}

.selection-score .score-value {
    font-size: clamp(24px, 6vw, 32px);
    color: var(--neon-violet);
    font-weight: 700;
    text-shadow: 0 0 10px rgba(187, 68, 255, 0.4);
}

.boss-slots-mini {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-top: 8px;
}

.boss-mini {
    font-size: 22px;
    padding: 6px 12px;
    border: 2px solid #00ff66;
    border-radius: 6px;
    color: #00ff66;
}

.boss-mini.locked {
    border-color: #555;
    color: #555;
}

.boss-mini.defeated {
    background: rgba(46, 204, 113, 0.25);
}

.selection-mode {
    display: flex;
    gap: 15px;
    order: 3; /* Move below launch button */
}

.mode-pill {
    background: transparent;
    border: 2px solid rgba(255, 255, 255, 0.3);
    color: rgba(255, 255, 255, 0.75);
    padding: 14px 28px;
    font-size: clamp(14px, 4vw, 16px);
    font-weight: 700;
    letter-spacing: 3px;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.2s;
}

.mode-pill:hover {
    border-color: rgba(255, 255, 255, 0.5);
    color: rgba(255, 255, 255, 0.7);
    background: rgba(255, 255, 255, 0.05);
}

.mode-pill.active {
    border-color: var(--neon-violet);
    color: var(--neon-violet);
    background: rgba(187, 68, 255, 0.15);
    box-shadow: 0 0 15px rgba(187, 68, 255, 0.3);
}

.btn-launch {
    background: linear-gradient(180deg, #bb44ff 0%, #9933dd 100%);
    border: 3px solid #000;
    color: #000;
    font-size: clamp(20px, 5vw, 26px);
    font-weight: 900;
    letter-spacing: 4px;
    padding: 18px 60px;
    border-radius: 12px;
    cursor: pointer;
    box-shadow: 0 5px 0 #6622aa, 0 0 30px rgba(187, 68, 255, 0.5);
    transition: all 0.15s;
    order: 2; /* Same position as TAP TO START */
}

.btn-launch:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 0 #6622aa, 0 0 40px rgba(187, 68, 255, 0.7);
    background: linear-gradient(180deg, #cc66ff 0%, #bb44ff 100%);
}

.btn-launch:active {
    transform: translateY(3px);
    box-shadow: 0 2px 0 #6622aa;
}

.ship-name {
    font-size: 18px;
    font-weight: 900;
    letter-spacing: 3px;
    color: var(--neon-violet);
    text-shadow:
        0 0 10px rgba(187, 68, 255, 0.5),
        -1px -1px 0 #000,
        1px -1px 0 #000,
        -1px 1px 0 #000,
        1px 1px 0 #000,
        0 0 8px rgba(0, 0, 0, 0.8);
    margin-top: 5px;
    height: 24px;
    line-height: 24px;
    flex-shrink: 0;
}

.ship-stats {
    display: flex;
    flex-wrap: nowrap;
    justify-content: center;
    align-items: center;
    gap: 8px;
    margin-top: 8px;
    font-size: 10px;
    color: #888;
    letter-spacing: 1px;
    height: 28px;
    overflow: hidden;
}

.stat-item {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    white-space: nowrap;
    color: #fff;
    font-weight: bold;
    line-height: 1;
    text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000,
                 -2px 0 0 #000, 2px 0 0 #000, 0 -2px 0 #000, 0 2px 0 #000;
}

.start-score {
    text-align: center;
    margin-top: 15px;
    margin-bottom: 10px;
    height: 85px;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-shrink: 0;
    overflow: hidden;
}

#arcade-score-display,
#campaign-progress {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 80px;
}

/* Game Mode Selector - Compact inline */
.game-mode-selector {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin: 10px 0;
    height: 44px;
    flex-shrink: 0;
}

.mode-btn {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: rgba(0, 0, 0, 0.6);
    border: 2px solid #444;
    border-radius: 8px;
    color: #888;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 12px;
}

.mode-btn:hover {
    border-color: #666;
    color: #aaa;
}

.mode-btn.active {
    border-color: var(--neon-violet);
    color: #fff;
    background: rgba(187, 68, 255, 0.15);
    box-shadow: 0 0 10px rgba(187, 68, 255, 0.3);
}

.mode-icon {
    font-size: 16px;
}

.mode-name {
    font-size: 12px;
    font-weight: 900;
    letter-spacing: 1px;
}

.mode-desc {
    display: none; /* Hidden for compact view */
}

/* Campaign Progress Display - Inline in score row */
#campaign-progress {
    text-align: center;
}

.boss-slots {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 6px;
    margin-top: 5px;
}

.boss-slot {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 4px;
    padding: 6px 10px;
    background: rgba(187, 68, 255, 0.2);
    border: 2px solid var(--neon-violet);
    border-radius: 6px;
    transition: all 0.3s ease;
}

.boss-slot.locked {
    background: rgba(100, 100, 100, 0.2);
    border-color: #444;
    opacity: 0.5;
}

.boss-slot.defeated {
    background: rgba(46, 204, 113, 0.2);
    border-color: #00ff66;
}

.boss-slot.current {
    animation: currentBossPulse 1.5s ease-in-out infinite;
    box-shadow: 0 0 10px rgba(187, 68, 255, 0.5);
}

@keyframes currentBossPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.03); }
}

.boss-icon {
    font-size: 16px;
    font-weight: bold;
}

.boss-label {
    font-size: 9px;
    font-weight: 900;
    letter-spacing: 1px;
}

.boss-arrow {
    color: #555;
    font-size: 12px;
}

.score-label {
    display: block;
    font-size: 11px;
    letter-spacing: 4px;
    color: #666;
    margin-bottom: 5px;
}

.score-value {
    font-size: 36px;
    font-weight: 900;
    color: var(--neon-violet);
    text-shadow: 0 0 15px rgba(187, 68, 255, 0.8);
}

.start-actions {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
    margin-top: 10px;
    margin-bottom: 30px;
    flex-shrink: 0;
}

/* .btn-play replaced by .btn-primary .btn-lg in Button Design System */

/* ========== INTRO REDESIGN v4.8.1 - Minimal Integrated Style ========== */

/* Mode Selector (SPLASH) - Simple pill buttons */
.mode-selector {
    margin: 15px 0;
    transition: all 0.4s ease;
}

.mode-selector.hidden {
    opacity: 0;
    transform: translateY(-10px);
    pointer-events: none;
    position: absolute;
}

.mode-pills {
    display: flex;
    gap: 20px;
    justify-content: center;
}

/* Reuse existing mode-pill style but ensure it works here */
.mode-selector .mode-pill {
    background: transparent;
    border: 2px solid rgba(255, 255, 255, 0.3);
    color: rgba(255, 255, 255, 0.75);
    padding: 14px 28px;
    font-size: clamp(15px, 4vw, 17px);
    font-weight: 700;
    letter-spacing: 3px;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.2s;
    font-family: inherit;
}

.mode-selector .mode-pill:hover {
    border-color: rgba(255, 255, 255, 0.5);
    color: rgba(255, 255, 255, 0.7);
    background: rgba(255, 255, 255, 0.05);
}

.mode-selector .mode-pill.active {
    border-color: var(--neon-violet);
    color: var(--neon-violet);
    background: rgba(187, 68, 255, 0.15);
    box-shadow: 0 0 15px rgba(187, 68, 255, 0.3);
}

/* .mode-pill-wip and .wip-tag removed — Arcade enabled (v5.8.0) */

/* Mode Explanation (SPLASH only) */
.mode-explanation {
    text-align: center;
    margin: 10px 0 15px 0;
    min-height: 40px;
    transition: all 0.3s ease;
}
.mode-explanation.hidden {
    opacity: 0; height: 0; margin: 0; overflow: hidden;
}
.mode-desc {
    font-size: clamp(16px, 4.4vw, 20px);
    color: var(--neon-violet);
    font-style: italic;
    line-height: 1.4;
    margin: 0; padding: 0 20px;
    text-shadow:
        -1px -1px 0 #000,
        1px -1px 0 #000,
        -1px 1px 0 #000,
        1px 1px 0 #000;
}


/* Ship Preview (SELECTION) */
.ship-area {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    margin: 10px 0;
}
.ship-preview-center {
    display: flex;
    justify-content: center;
    align-items: center;
}
#intro-ship-canvas {
    background: transparent;
    border: none;
    filter: drop-shadow(0 0 25px rgba(187, 68, 255, 0.7));
}
.ship-area.hidden {
    opacity: 0; height: 0; margin: 0; overflow: hidden;
    pointer-events: none;
    transition: all 0.3s ease;
}
.ship-arrow {
    background: none;
    border: 1px solid rgba(187, 68, 255, 0.3);
    color: rgba(187, 68, 255, 0.7);
    font-size: 28px;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color 0.2s, border-color 0.2s;
    flex-shrink: 0;
}
.ship-arrow:active {
    color: #bb44ff;
    border-color: #bb44ff;
}

/* Ship Info (SELECTION) */
.selection-info {
    text-align: center;
    animation: infoFadeIn 0.5s ease-out 0.15s both;
}
@keyframes infoFadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
}
.ship-name-large {
    font-size: clamp(22px, 6vw, 28px);
    font-weight: 900;
    letter-spacing: 4px;
    color: var(--neon-violet);
    text-shadow:
        0 0 20px rgba(187, 68, 255, 0.6),
        -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000;
    margin-bottom: 10px;
}
.ship-stats-large {
    display: flex;
    flex-direction: column;
    gap: 6px;
    font-size: clamp(13px, 3.5vw, 16px);
    color: #ccc;
    font-family: 'Courier New', monospace;
}
.ship-stats-large .stat-item {
    text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
}

/* Current Mode Indicator (SELECTION) - Minimal text style */
.current-mode-indicator {
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    transition: all 0.2s ease;
    margin: 8px 0 20px;
    padding: 10px 24px;
    animation: fadeSlideUp 0.3s ease-out;
}

.current-mode-indicator:hover {
    transform: scale(1.02);
}

.current-mode-indicator:active {
    transform: scale(0.98);
}

.mode-indicator-text {
    font-size: clamp(18px, 4.5vw, 22px);
    font-weight: 700;
    color: var(--neon-violet);
    letter-spacing: 4px;
    text-shadow: 0 0 12px rgba(187, 68, 255, 0.5);
}

.mode-indicator-hint {
    font-size: 13px;
    color: rgba(200, 180, 255, 0.7);
    letter-spacing: 2px;
    margin-top: 4px;
}

/* Selection Score Row - Clean inline display */
.selection-score-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    margin: 5px 0;
    animation: fadeSlideUp 0.4s ease-out 0.1s both;
}

.score-row-label {
    font-size: 12px;
    color: rgba(200, 180, 255, 0.7);
    letter-spacing: 3px;
}

.score-row-value {
    font-size: clamp(20px, 5vw, 26px);
    font-weight: 900;
    color: #ffaa00;
    text-shadow: 0 0 10px rgba(255, 170, 0, 0.5);
}

/* PRIMARY ACTION CONTAINER - FIXED POSITION */
.primary-action-container {
    position: absolute;
    bottom: calc(115px + var(--pwa-bottom-inset, env(safe-area-inset-bottom, 0px)));
    left: 50%;
    transform: translateX(-50%);
    width: calc(100% - 60px);
    max-width: 320px;
    z-index: 10;
}

/* .btn-primary-action replaced by .btn-cta in Button Design System */

/* Responsive adjustments for small screens */
@media (max-width: 375px) {
    .mode-selector .mode-pill {
        padding: 8px 18px;
        font-size: 12px;
        letter-spacing: 2px;
    }
    .primary-action-container {
        width: calc(100% - 40px);
    }
}

@media (max-height: 600px) {
    .mode-selector {
        margin: 8px 0;
    }
    .current-mode-indicator {
        margin: 4px 0;
        padding: 4px 15px;
    }
    .ship-area {
        margin: 8px 0;
    }
    .selection-score-row {
        margin: 3px 0;
    }
    .primary-action-container {
        bottom: calc(80px + var(--pwa-bottom-inset, env(safe-area-inset-bottom, 0px)));
    }
}

/* Game Over Actions */
.gameover-actions {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-top: 20px;
    align-items: center;
}

/* Old .btn-secondary, .btn-play version-text replaced by Button Design System */

/* Legacy classes kept for compatibility */
.neon-title {
    font-size: clamp(44px, 7vw, 65px);
    line-height: 1.1;
    color: #fff;
    text-shadow: 0 0 30px var(--neon-violet), 0 0 10px var(--neon-violet);
    margin: 0 0 14px 0;
}

.menu-row {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 20px;
}

/* .icon-btn replaced by .btn-icon-round in Button Design System */

/* .btn-coin replaced by .btn-primary in Button Design System */

.controls-hint {
    margin-top: 30px;
    font-size: 12px;
    color: #888;
    line-height: 1.8;
    letter-spacing: 1px;
}

.glitch-text {
    font-size: clamp(28px, 8vw, 42px);
    color: #ff2d95;
    margin: 0;
    text-shadow: 3px 3px 0px #fff;
    animation: shake 0.4s infinite;
    font-weight: 900;
    letter-spacing: 2px;
}

.final-score {
    font-size: 46px;
    color: var(--neon-violet);
    text-shadow: 0 0 18px var(--neon-violet);
}

#gameover-meme {
    color: #6aa9ff;
    font-family: 'Courier New', monospace;
    font-size: 16px;
    margin: 8px 0;
}

#roast-msg {
    color: var(--neon-violet);
    font-family: 'Courier New', monospace;
    font-size: 16px;
    margin: 10px 0;
}

@keyframes pulseTitle {
    from {
        filter: brightness(1);
        scale: 1;
    }

    to {
        filter: brightness(1.3);
        scale: 1.02;
    }
}

/* TOUCH */
#touchControls {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 50;
    display: none;
    opacity: 0;
    transition: opacity 0.15s ease-in;
    -webkit-tap-highlight-color: transparent;
}

#touchControls.visible {
    opacity: 1;
}

.terminal-boot {
    width: 100%;
    max-width: 520px;
    border: 1px solid var(--terminal-border);
    background: var(--terminal-bg);
    padding: 16px;
    margin-bottom: 18px;
    box-shadow: 0 0 18px var(--terminal-glow);
    margin-top: 30px;
}

#gameover-stats {
    font-size: 12px;
    letter-spacing: 2px;
    color: #8c8c8c;
    margin: 8px 0 12px;
    text-transform: uppercase;
    border-top: 1px solid rgba(255, 255, 255, 0.06);
    border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    padding: 8px 0;
}

#arcade-stats-row {
    display: flex;
    justify-content: center;
    gap: 18px;
    font-size: 11px;
    letter-spacing: 2px;
    color: #8c8c8c;
    text-transform: uppercase;
    margin: 6px 0;
}
#arcade-stats-row b {
    color: #ddd;
    margin-left: 4px;
}

#new-best-badge {
    display: inline-block;
    font-size: 14px;
    font-weight: 900;
    letter-spacing: 3px;
    padding: 4px 18px;
    margin: 6px auto;
    background: linear-gradient(135deg, #9933dd, #cc66ff);
    color: #fff;
    border-radius: 4px;
    text-shadow: 0 0 6px rgba(187,68,255,0.5);
    animation: badgePulse 1s ease-in-out infinite alternate;
}
@keyframes badgePulse {
    from { box-shadow: 0 0 8px rgba(187,68,255,0.5); }
    to { box-shadow: 0 0 18px rgba(187,68,255,0.9); }
}

#arcade-records-row {
    display: flex;
    justify-content: center;
    gap: 10px;
    font-size: 10px;
    letter-spacing: 1.5px;
    color: #8c8c8c;
    text-transform: uppercase;
    margin: 4px 0;
    animation: fadeSlideUp 0.4s ease-out 0.2s both;
}
#arcade-records-row b {
    color: var(--neon-violet);
    margin: 0 6px 0 3px;
}

@keyframes tickerIn {
    from { opacity: 0; transform: translateX(10px); }
    to { opacity: 1; transform: translateX(0); }
}

.terminal-header {
    text-align: center;
}

.terminal-log {
    font-size: 11px;
    color: #6aa9ff;
    letter-spacing: 2px;
    line-height: 1.6;
    margin-top: 10px;
    text-transform: uppercase;
    background: rgba(0, 0, 0, 0.2);
    padding: 8px;
    border: 1px dashed rgba(106, 169, 255, 0.2);
}

.terminal-meme {
    font-size: 12px;
    letter-spacing: 4px;
    color: #6bdba6;
    text-transform: uppercase;
    margin-top: 6px;
    text-shadow: 0 0 8px rgba(107, 219, 166, 0.35);
}

#joystick {
    position: absolute;
    left: 50%;
    bottom: calc(5px + var(--pwa-bottom-inset, env(safe-area-inset-bottom, 0px)));
    transform: translateX(-50%);
    width: 75px;
    height: 75px;
    pointer-events: auto;
    -webkit-tap-highlight-color: transparent;
}

#joystick-base {
    position: absolute;
    left: 0;
    top: 0;
    width: 75px;
    height: 75px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

#joystick-stick {
    position: absolute;
    left: 22px;
    top: 22px;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: rgba(187, 68, 255, 0.8);
    box-shadow: 0 0 10px rgba(187, 68, 255, 0.8);
    transform: translate(0, 0);
    transition: transform 0.05s linear;
}

@media (hover: none) and (pointer: coarse) {
    #touchControls {
        display: block;
    }
}

.touch-zone-left,
.touch-zone-right {
    position: absolute;
    bottom: 0;
    width: 50%;
    height: 100%;  /* fills parent touchControls height */
    -webkit-tap-highlight-color: transparent;
    background: transparent;
}

.touch-zone-left {
    left: 0;
}

.touch-zone-right {
    right: 0;
}

/* Shield Button - Cell-shaded style with radial cooldown indicator */
.shield-btn-wrapper {
    position: absolute;
    left: 20px;
    bottom: calc(90px + var(--pwa-bottom-inset, env(safe-area-inset-bottom, 0px)));
    width: 72px;
    height: 72px;
    pointer-events: auto;
    touch-action: none;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
    z-index: 150;
}

.shield-radial {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    transform: rotate(-90deg);
    pointer-events: none;
}

.shield-radial-bg {
    fill: none;
    stroke: rgba(0, 240, 255, 0.15);
    stroke-width: 4;
}

.shield-radial-progress {
    fill: none;
    stroke: #0ff;
    stroke-width: 4;
    stroke-linecap: round;
    stroke-dasharray: 188.5;
    stroke-dashoffset: 0;
    transition: stroke-dashoffset 0.1s linear, stroke 0.2s ease;
}

.shield-btn-face {
    position: absolute;
    top: 4px;
    left: 4px;
    width: 56px;
    height: 56px;
    border-radius: 50%;
    background: linear-gradient(135deg, #0ff 0%, #088 100%);
    border: 2px solid rgba(0, 240, 255, 0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow:
        inset 2px 2px 4px rgba(255, 255, 255, 0.3),
        inset -2px -2px 4px rgba(0, 0, 0, 0.2),
        0 4px 8px rgba(0, 0, 0, 0.4),
        0 0 8px rgba(0, 240, 255, 0.4);
    transition: transform 0.1s ease, box-shadow 0.2s ease, background 0.2s ease;
    pointer-events: none;
}

.shield-icon {
    font-size: 24px;
    filter: drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.5));
    pointer-events: none;
}

/* READY state - Cyan with pulsing glow */
.shield-btn-wrapper.ready .shield-btn-face {
    background: linear-gradient(135deg, #0ff 0%, #088 100%);
    box-shadow:
        inset 2px 2px 4px rgba(255, 255, 255, 0.3),
        inset -2px -2px 4px rgba(0, 0, 0, 0.2),
        0 4px 8px rgba(0, 0, 0, 0.4),
        0 0 15px rgba(0, 255, 255, 0.6);
    animation: shield-pulse 1.5s ease-in-out infinite;
}

.shield-btn-wrapper.ready .shield-radial-progress {
    stroke: #0ff;
    stroke-dashoffset: 0;
}

/* ACTIVE state - Bright white with intense glow */
.shield-btn-wrapper.active .shield-btn-face {
    background: linear-gradient(135deg, #fff 0%, #aff 100%);
    border-color: #000;
    box-shadow:
        inset 2px 2px 4px rgba(255, 255, 255, 0.5),
        inset -2px -2px 4px rgba(0, 0, 0, 0.1),
        0 4px 8px rgba(0, 0, 0, 0.4),
        0 0 25px rgba(255, 255, 255, 0.8),
        0 0 40px rgba(0, 255, 255, 0.5);
    animation: shield-active-pulse 0.3s ease-in-out infinite;
}

.shield-btn-wrapper.active .shield-radial-progress {
    stroke: #fff;
    stroke-dashoffset: 0;
    animation: shield-radial-pulse 0.5s ease-in-out infinite;
}

/* COOLDOWN state - Grey, no glow, radial fills up */
.shield-btn-wrapper.cooldown .shield-btn-face {
    background: linear-gradient(135deg, #666 0%, #333 100%);
    border-color: rgba(100, 100, 100, 0.6);
    box-shadow:
        inset 2px 2px 4px rgba(255, 255, 255, 0.1),
        inset -2px -2px 4px rgba(0, 0, 0, 0.3),
        0 4px 8px rgba(0, 0, 0, 0.4);
    animation: none;
}

.shield-btn-wrapper.cooldown .shield-radial-progress {
    stroke: #0aa;
}

/* Press feedback */
.shield-btn-wrapper:active .shield-btn-face {
    transform: translateY(2px) scale(0.95);
    box-shadow:
        inset 2px 2px 4px rgba(255, 255, 255, 0.2),
        inset -2px -2px 4px rgba(0, 0, 0, 0.3),
        0 2px 4px rgba(0, 0, 0, 0.4);
}

/* Animations */
@keyframes shield-pulse {
    0%, 100% {
        box-shadow:
            inset 2px 2px 4px rgba(255, 255, 255, 0.3),
            inset -2px -2px 4px rgba(0, 0, 0, 0.2),
            0 4px 8px rgba(0, 0, 0, 0.4),
            0 0 10px rgba(0, 255, 255, 0.4);
    }
    50% {
        box-shadow:
            inset 2px 2px 4px rgba(255, 255, 255, 0.3),
            inset -2px -2px 4px rgba(0, 0, 0, 0.2),
            0 4px 8px rgba(0, 0, 0, 0.4),
            0 0 20px rgba(0, 255, 255, 0.7);
    }
}

@keyframes shield-active-pulse {
    0%, 100% {
        box-shadow:
            inset 2px 2px 4px rgba(255, 255, 255, 0.5),
            inset -2px -2px 4px rgba(0, 0, 0, 0.1),
            0 4px 8px rgba(0, 0, 0, 0.4),
            0 0 20px rgba(255, 255, 255, 0.7),
            0 0 35px rgba(0, 255, 255, 0.4);
    }
    50% {
        box-shadow:
            inset 2px 2px 4px rgba(255, 255, 255, 0.5),
            inset -2px -2px 4px rgba(0, 0, 0, 0.1),
            0 4px 8px rgba(0, 0, 0, 0.4),
            0 0 30px rgba(255, 255, 255, 0.9),
            0 0 50px rgba(0, 255, 255, 0.6);
    }
}

@keyframes shield-radial-pulse {
    0%, 100% { stroke-width: 4; }
    50% { stroke-width: 6; }
}

/* ═══ HYPER BUTTON (v4.0.4) ═══ */
.hyper-btn-wrapper {
    position: absolute;
    right: 20px;
    bottom: calc(75px + var(--pwa-bottom-inset, env(safe-area-inset-bottom, 0px)));
    width: 64px;
    height: 64px;
    pointer-events: auto;
    touch-action: none;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
    z-index: 150;
    opacity: 0.3;
    transition: opacity 0.3s ease;
    display: none; /* Hidden until touch device detected */
}

.hyper-btn-wrapper.visible {
    display: block;
}

.hyper-btn-wrapper.ready {
    opacity: 1.0;
}

.hyper-radial {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    transform: rotate(-90deg);
    pointer-events: none;
}

.hyper-radial-bg {
    fill: none;
    stroke: rgba(0, 0, 0, 0.3);
    stroke-width: 4;
}

.hyper-radial-progress {
    fill: none;
    stroke: #FFD700;
    stroke-width: 4;
    stroke-linecap: round;
    stroke-dasharray: 188.5;
    stroke-dashoffset: 188.5;
    transition: stroke-dashoffset 0.1s linear;
}

.hyper-btn-face {
    position: absolute;
    top: 4px;
    left: 4px;
    width: 56px;
    height: 56px;
    border-radius: 50%;
    background: linear-gradient(135deg, #666 0%, #333 100%);
    border: 3px solid #000;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow:
        inset 2px 2px 4px rgba(255, 255, 255, 0.1),
        inset -2px -2px 4px rgba(0, 0, 0, 0.3),
        0 4px 8px rgba(0, 0, 0, 0.4);
    transition: transform 0.1s ease, box-shadow 0.2s ease, background 0.2s ease;
    pointer-events: none;
}

.hyper-icon {
    font-size: 24px;
    filter: drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.5));
    pointer-events: none;
}

/* READY state - Gold with pulsing glow */
.hyper-btn-wrapper.ready .hyper-btn-face {
    background: linear-gradient(135deg, #FFD700 0%, #B8860B 100%);
    box-shadow:
        inset 2px 2px 4px rgba(255, 255, 255, 0.3),
        inset -2px -2px 4px rgba(0, 0, 0, 0.2),
        0 4px 8px rgba(0, 0, 0, 0.4),
        0 0 15px rgba(255, 215, 0, 0.6);
    animation: hyper-pulse 1.0s ease-in-out infinite;
}

.hyper-btn-wrapper.ready .hyper-radial-progress {
    stroke: #FFD700;
    stroke-dashoffset: 0;
}

/* ACTIVE state - White-gold intense glow */
.hyper-btn-wrapper.active .hyper-btn-face {
    background: linear-gradient(135deg, #fff 0%, #FFD700 100%);
    box-shadow:
        inset 2px 2px 4px rgba(255, 255, 255, 0.5),
        inset -2px -2px 4px rgba(0, 0, 0, 0.1),
        0 4px 8px rgba(0, 0, 0, 0.4),
        0 0 25px rgba(255, 215, 0, 0.8),
        0 0 40px rgba(255, 255, 255, 0.5);
    animation: hyper-active-pulse 0.3s ease-in-out infinite;
}

/* Press feedback */
.hyper-btn-wrapper:active .hyper-btn-face {
    transform: translateY(2px) scale(0.95);
}

@keyframes hyper-pulse {
    0%, 100% {
        box-shadow:
            inset 2px 2px 4px rgba(255, 255, 255, 0.3),
            inset -2px -2px 4px rgba(0, 0, 0, 0.2),
            0 4px 8px rgba(0, 0, 0, 0.4),
            0 0 10px rgba(255, 215, 0, 0.4);
    }
    50% {
        box-shadow:
            inset 2px 2px 4px rgba(255, 255, 255, 0.3),
            inset -2px -2px 4px rgba(0, 0, 0, 0.2),
            0 4px 8px rgba(0, 0, 0, 0.4),
            0 0 20px rgba(255, 215, 0, 0.8);
    }
}

@keyframes hyper-active-pulse {
    0%, 100% {
        box-shadow:
            inset 2px 2px 4px rgba(255, 255, 255, 0.5),
            inset -2px -2px 4px rgba(0, 0, 0, 0.1),
            0 4px 8px rgba(0, 0, 0, 0.4),
            0 0 20px rgba(255, 215, 0, 0.8),
            0 0 35px rgba(255, 255, 255, 0.5);
    }
    50% {
        box-shadow:
            inset 2px 2px 4px rgba(255, 255, 255, 0.5),
            inset -2px -2px 4px rgba(0, 0, 0, 0.1),
            0 4px 8px rgba(0, 0, 0, 0.4),
            0 0 30px rgba(255, 215, 0, 1.0),
            0 0 50px rgba(255, 255, 255, 0.7);
    }
}

@keyframes pulse {
    from {
        opacity: 0.8;
        transform: scale(1);
    }

    to {
        opacity: 1;
        transform: scale(1.02);
    }
}

/* @keyframes blinkBtn removed — no longer used */

@keyframes shake {
    0% {
        transform: translate(2px, 2px);
    }

    50% {
        transform: translate(-2px, -2px);
    }
}

/* Damage Flash Overlay */
@keyframes damageFlash {
    0% {
        background: rgba(255, 0, 0, 0.4);
    }

    100% {
        background: transparent;
    }
}

.hit-effect {
    animation: damageFlash 0.2s ease-out;
}

/* --- HERO SHOWCASE --- */
#hero-showcase {
    position: relative;
    width: 200px;
    /* Reduced container width */
    height: 200px;
    margin: 20px auto;
    /* Auto margin for centering block */
    animation: floatHero 4s ease-in-out infinite;
    filter: drop-shadow(0 0 20px rgba(0, 240, 255, 0.4));
    display: flex;
    justify-content: center;
    /* Flex centering */
    align-items: center;
}
}

@keyframes floatHero {

    0%,
    100% {
        transform: translateY(0);
    }

    50% {
        transform: translateY(-15px);
    }
}

/* --- SETTINGS BUTTON (pause menu item) --- */

/* --- MOBILE LAYOUT TWEAK --- */
@media (max-width: 600px) {
    .intro-action {
        margin-bottom: 60px;
    }
}

/* --- SETTINGS MODAL --- */
#settings-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(8px);
    z-index: 200;
    display: flex;
    justify-content: center;
    align-items: center;
}

.modal-content {
    background: #0a0a18;
    border: 2px solid var(--neon-cyan);
    padding: 30px;
    width: 90%;
    max-width: 400px;
    text-align: center;
    border-radius: 12px;
    box-shadow: 0 0 30px rgba(0, 240, 255, 0.2);
}

.setting-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    font-size: 18px;
    font-weight: bold;
    color: #ccc;
}

.toggle-btn {
    background: #333;
    color: #fff;
    border: none;
    padding: 8px 16px;
    font-family: inherit;
    cursor: pointer;
    border-radius: 4px;
}

.how-to-play {
    text-align: left;
    background: #000;
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #333;
    margin-bottom: 20px;
}

.how-to-play h3 {
    margin-top: 0;
    color: var(--neon-violet);
    font-size: 14px;
}

.how-to-play p {
    font-size: 12px;
    color: #aaa;
    margin: 8px 0;
    line-height: 1.4;
}

/* .btn-coin.mini replaced by .btn-sm in Button Design System */

/* --- HANGAR SCREEN --- */
#hangar-screen {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at center, #1a1a2e 0%, #000 100%);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 100;
}

.ship-container {
    display: flex;
    gap: 20px;
    margin: 40px 0;
    flex-wrap: wrap;
    justify-content: center;
}

.ship-card {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid #333;
    padding: 20px;
    width: 140px;
    border-radius: 12px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.ship-card:hover {
    transform: translateY(-10px);
    background: rgba(255, 255, 255, 0.1);
    border-color: #666;
}

.ship-card h3 {
    font-size: 12px;
    margin: 10px 0;
    letter-spacing: 1px;
    color: #fff;
}

.ship-icon {
    font-size: 50px;
    margin-bottom: 10px;
    filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.2));
}

.stats .stat {
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-size: 10px;
    color: #888;
    margin: 4px 0;
}

.stats .bar {
    width: 60px;
    height: 4px;
    background: #333;
    border-radius: 2px;
    overflow: hidden;
}

.stats .bar div {
    height: 100%;
}

/* New stat row format for ship selection */
.stat-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-size: 11px;
    margin: 6px 0;
    padding: 4px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.stat-row:last-child {
    border-bottom: none;
}

.stat-icon {
    font-size: 12px;
    width: 18px;
    text-align: center;
}

.stat-name {
    color: #888;
    font-size: 10px;
    flex: 1;
    text-align: left;
    margin-left: 6px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.stat-value {
    font-size: 11px;
    letter-spacing: -1px;
    font-weight: bold;
}

.ship-trait {
    padding: 4px 8px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 4px;
    display: inline-block;
}

/* --- PAUSE UI --- */
/* #pause-btn replaced by harmonized rule above */

#pause-screen {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(5px);
    z-index: 120;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 14px;
}

#pause-screen h1 {
    margin-bottom: 40px;
}

#pause-screen .btn {
    margin: 0;
    animation: none;
    justify-content: center;
}

/* --- BEAR MARKET MODE 🐻 --- */
body.bear-mode {
    filter: sepia(100%) hue-rotate(-50deg) saturate(300%) contrast(1.2);
    /* Turns everything RED and CONTRAST */
}

body.bear-mode .neon-title {
    animation: shake 2s infinite;
}

/* Legacy btn-bear styles removed - using new toggle design above */

@media (max-height: 740px) {
    #intro-screen,
    #gameover-screen {
        padding-top: 50px;
    }
    .terminal-boot {
        margin-top: 18px;
    }
    .neon-title {
        font-size: clamp(40px, 7vw, 60px);
    }
    .subtitle {
        letter-spacing: 6px;
    }
}

.setting-row input[type="range"] {
    width: 160px;
    accent-color: var(--neon-violet);
}

#control-toast {
    position: absolute;
    left: 50%;
    bottom: calc(150px + var(--pwa-bottom-inset, env(safe-area-inset-bottom, 0px)));
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.7);
    border: 1px solid #333;
    color: #fff;
    padding: 8px 12px;
    font-size: 12px;
    letter-spacing: 1px;
    display: none;
    z-index: 140;
    pointer-events: none;
}

/* --- MEME POPUP v4.20.0 --- */
#meme-popup {
    position: absolute;
    bottom: calc(240px + var(--pwa-bottom-inset, env(safe-area-inset-bottom, 0px)));
    left: 0;
    right: 0;
    z-index: 90;
    pointer-events: none;
    display: flex;
    justify-content: center;
    align-items: center;
    visibility: hidden;
    opacity: 0;
}

#meme-popup.show {
    visibility: visible;
    opacity: 1;
    animation: memeEntrance 150ms cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

#meme-popup.hide {
    visibility: visible;
    opacity: 1;
    animation: memeExit 250ms ease-in forwards;
}

.meme-box {
    display: inline-block;
    text-align: center;
    max-width: 92%;
    padding: 0 20px;
}

.meme-emoji {
    font-family: 'Press Start 2P', 'Courier New', monospace;
    font-size: 10px;
    font-weight: 900;
    font-style: normal;
    letter-spacing: 2px;
    color: #bb44ff;
    text-transform: uppercase;
    text-shadow:
        -1px -1px 0 #000,
         1px -1px 0 #000,
        -1px  1px 0 #000,
         1px  1px 0 #000,
         0    0  8px rgba(187, 68, 255, 0.5);
    margin-bottom: 4px;
}

.meme-emoji:empty {
    display: none;
}

.meme-text {
    font-family: 'Press Start 2P', 'Courier New', monospace;
    font-size: 16px;
    font-style: italic;
    font-weight: bold;
    color: #bb44ff;
    line-height: 1.4;
    text-align: center;
    word-break: break-word;
    text-shadow:
        -2px -2px 0 #000,
         2px -2px 0 #000,
        -2px  2px 0 #000,
         2px  2px 0 #000,
         0    0  8px rgba(187, 68, 255, 0.4);
}

@keyframes memeEntrance {
    0%   { transform: scale(0.3); opacity: 0; }
    70%  { transform: scale(1.08); opacity: 1; }
    100% { transform: scale(1); opacity: 1; }
}

@keyframes memeExit {
    0%   { transform: scale(1); opacity: 1; }
    100% { transform: scale(0.8); opacity: 0; }
}

/* Tier variants */
.tier-critical .meme-text {
    color: #FF4444;
    text-shadow:
        -2px -2px 0 #000,
         2px -2px 0 #000,
        -2px  2px 0 #000,
         2px  2px 0 #000,
         0    0  10px rgba(255, 68, 68, 0.5);
}

.tier-critical .meme-emoji {
    color: #FF4444;
    text-shadow:
        -1px -1px 0 #000, 1px -1px 0 #000,
        -1px  1px 0 #000, 1px  1px 0 #000,
         0    0  8px rgba(255, 68, 68, 0.5);
}

.tier-high .meme-text {
    color: #bb44ff;
}

.tier-normal .meme-text {
    color: #c0a030;
    text-shadow:
        -2px -2px 0 #000,
         2px -2px 0 #000,
        -2px  2px 0 #000,
         2px  2px 0 #000,
         0    0  6px rgba(192, 160, 48, 0.3);
}

.tier-normal .meme-emoji {
    color: #c0a030;
    text-shadow:
        -1px -1px 0 #000, 1px -1px 0 #000,
        -1px  1px 0 #000, 1px  1px 0 #000,
         0    0  6px rgba(192, 160, 48, 0.3);
}

@media (max-width: 380px) {
    .meme-text { font-size: 13px; }
    .meme-box { padding: 0 12px; }
}

/* --- MESSAGE STRIP v4.26.0 --- */
#message-strip {
    position: absolute;
    top: calc(67px + var(--pwa-top-inset, env(safe-area-inset-top, 0px)));
    left: 0;
    right: 0;
    z-index: 110;
    pointer-events: none;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 6px 16px;
    min-height: 28px;
    visibility: hidden;
    opacity: 0;
}

.strip-text {
    font-family: 'Press Start 2P', 'Courier New', monospace;
    font-size: 13px;
    font-weight: bold;
    text-align: center;
    line-height: 1.3;
    text-shadow:
        -2px -2px 0 #000,
         2px -2px 0 #000,
        -2px  2px 0 #000,
         2px  2px 0 #000;
}

/* Show/Hide */
#message-strip.show {
    visibility: visible;
    opacity: 1;
    animation: stripEntrance 200ms cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

#message-strip.hide {
    visibility: visible;
    opacity: 1;
    animation: stripExit 300ms ease-in forwards;
}

/* Type: Wave — medium attention */
#message-strip.type-wave {
    background: rgba(0, 0, 0, 0.50);
}
#message-strip.type-wave .strip-text {
    color: #bb44ff;
    font-size: 14px;
}

/* Type: Danger — high attention */
#message-strip.type-danger {
    background: linear-gradient(rgba(120, 0, 0, 0.88), rgba(60, 0, 0, 0.78));
    border-bottom: 2px solid #FF0000;
    padding: 8px 16px;
}
#message-strip.type-danger .strip-text {
    color: #FF4444;
    font-size: 18px;
    letter-spacing: 2px;
    text-shadow:
        -2px -2px 0 #000,
         2px -2px 0 #000,
        -2px  2px 0 #000,
         2px  2px 0 #000,
         0    0  10px rgba(255, 0, 0, 0.6),
         0    0  20px rgba(255, 0, 0, 0.3);
}
#message-strip.type-danger.show {
    animation: stripEntrance 200ms cubic-bezier(0.34, 1.56, 0.64, 1) forwards,
               stripPulse 400ms ease-in-out 200ms 1;
}

/* Type: Victory — high attention */
#message-strip.type-victory {
    background: linear-gradient(rgba(80, 60, 0, 0.88), rgba(40, 30, 0, 0.78));
    border-bottom: 2px solid #bb44ff;
    padding: 8px 16px;
}
#message-strip.type-victory .strip-text {
    color: #bb44ff;
    font-size: 18px;
    letter-spacing: 2px;
    text-shadow:
        -2px -2px 0 #000,
         2px -2px 0 #000,
        -2px  2px 0 #000,
         2px  2px 0 #000,
         0    0  10px rgba(187, 68, 255, 0.6),
         0    0  20px rgba(187, 68, 255, 0.3);
}

/* Type: Info — low attention */
#message-strip.type-info {
    background: rgba(0, 0, 0, 0.35);
}
#message-strip.type-info .strip-text {
    color: #00E5FF;
    font-size: 12px;
    font-weight: normal;
    opacity: 0.85;
    text-shadow:
        -1px -1px 0 #000,
         1px -1px 0 #000,
        -1px  1px 0 #000,
         1px  1px 0 #000,
         0    0  4px rgba(0, 229, 255, 0.3);
}

/* Type: Pickup — power-up/perk feedback v5.4.0 */
#message-strip.type-pickup {
    background: rgba(0, 0, 0, 0.55);
    border-bottom: 1px solid #00f0ff;
}
#message-strip.type-pickup .strip-text {
    color: #00f0ff;
    font-size: 13px;
    text-shadow:
        -1px -1px 0 #000,
         1px -1px 0 #000,
        -1px  1px 0 #000,
         1px  1px 0 #000,
         0    0  6px rgba(0, 240, 255, 0.4);
}
#message-strip.type-pickup.show {
    animation: pickupScaleIn 150ms cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

@keyframes pickupScaleIn {
    0%   { transform: scale(0.7); opacity: 0; }
    70%  { transform: scale(1.05); }
    100% { transform: scale(1); opacity: 1; }
}

@keyframes stripEntrance {
    0%   { transform: translateY(-100%); }
    70%  { transform: translateY(2px); }
    100% { transform: translateY(0); }
}

@keyframes stripExit {
    0%   { transform: translateY(0); opacity: 1; }
    100% { transform: translateY(-8px); opacity: 0; }
}

@keyframes stripPulse {
    0%   { filter: brightness(1); }
    50%  { filter: brightness(1.6); }
    100% { filter: brightness(1); }
}

@media (max-width: 380px) {
    .strip-text { font-size: 12px; }
    #message-strip.type-danger .strip-text,
    #message-strip.type-victory .strip-text { font-size: 15px; }
    #message-strip.type-info .strip-text { font-size: 11px; }
    #message-strip.type-pickup .strip-text { font-size: 12px; }
    #message-strip { padding: 4px 10px; }
}

@media (max-width: 320px) {
    .strip-text { font-size: 11px; }
    #message-strip.type-danger .strip-text,
    #message-strip.type-victory .strip-text { font-size: 13px; }
    #message-strip.type-info .strip-text { font-size: 10px; }
    #message-strip.type-pickup .strip-text { font-size: 11px; }
}

/* --- PERK CHOICE MODAL --- */
#perk-modal {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    height: 100%;
    max-width: 600px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.6);
    z-index: 130;
    pointer-events: auto;
}

.perk-panel {
    width: calc(100% - 40px);
    max-width: 520px;
    background: var(--terminal-bg);
    border: 1px solid var(--terminal-border);
    box-shadow: 0 0 20px var(--terminal-glow);
    padding: 20px;
    text-align: center;
}

.terminal-panel {
    background-image:
        linear-gradient(rgba(10, 20, 30, 0.08) 1px, transparent 1px),
        linear-gradient(90deg, rgba(10, 20, 30, 0.08) 1px, transparent 1px);
    background-size: 32px 32px, 32px 32px;
}

.terminal-header-small {
    font-size: 10px;
    letter-spacing: 4px;
    color: #6aa9ff;
    margin-bottom: 6px;
}

.perk-options {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
    margin: 12px 0 16px;
}

.perk-card {
    background: rgba(5, 10, 15, 0.6);
    border: 1px solid rgba(106, 169, 255, 0.25);
    color: #fff;
    padding: 14px;
    text-align: left;
    cursor: pointer;
    transition: transform 0.08s ease, border-color 0.08s ease;
}

.perk-card:hover {
    transform: translateY(-2px);
    border-color: var(--neon-violet);
    box-shadow: 0 0 12px rgba(187, 68, 255, 0.25);
}

.perk-card .perk-name {
    font-weight: bold;
    color: var(--neon-violet);
}

.perk-card .perk-desc {
    color: #bbb;
    font-size: 12px;
    margin-top: 6px;
}

.perk-card .perk-rarity {
    font-size: 10px;
    letter-spacing: 1px;
    color: #6aa9ff;
    margin-top: 8px;
    text-transform: uppercase;
}

.perk-card.rarity-common .perk-name { color: #bbb; }
.perk-card.rarity-uncommon .perk-name { color: #6bdba6; }
.perk-card.rarity-rare .perk-name { color: #6aa9ff; }
.perk-card.rarity-epic .perk-name { color: #f3a4ff; }

/* Pause Button - HUD Top-Left (under lives) - Gold pill */
#pause-btn {
    position: absolute;
    left: 10px;
    top: calc(47px + var(--pwa-top-inset, env(safe-area-inset-top, 0px)));
    width: 58px;
    height: 48px;
    border-radius: 8px;
    border: 2px solid #000;
    background: linear-gradient(180deg, #bb44ff 0%, #9933dd 100%);
    color: #000;
    font-size: 16px;
    font-weight: bold;
    pointer-events: auto;
    z-index: 150;
    display: none;
    transition: all 0.15s ease;
    box-shadow:
        0 2px 4px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.3);
    touch-action: none;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
}

#pause-btn:active {
    transform: scale(0.95);
    background: linear-gradient(180deg, #9933dd 0%, #7722aa 100%);
}

@keyframes pause-pulse {
    0%, 100% {
        box-shadow:
            inset 2px 2px 4px rgba(255, 255, 255, 0.3),
            inset -2px -2px 4px rgba(0, 0, 0, 0.2),
            0 4px 8px rgba(0, 0, 0, 0.4),
            0 0 10px rgba(187, 68, 255, 0.3);
    }
    50% {
        box-shadow:
            inset 2px 2px 4px rgba(255, 255, 255, 0.3),
            inset -2px -2px 4px rgba(0, 0, 0, 0.2),
            0 4px 8px rgba(0, 0, 0, 0.4),
            0 0 20px rgba(187, 68, 255, 0.6);
    }
}

@media (min-width: 520px) {
    .perk-options {
        grid-template-columns: repeat(3, 1fr);
    }
    .perk-card {
        text-align: left;
        min-height: 120px;
    }
}

/* --- KILL COUNTER (removed in v4.4) --- */

/* --- GRAZE METER --- */
#graze-meter {
    position: absolute;
    bottom: calc(85px + var(--pwa-bottom-inset, env(safe-area-inset-bottom, 0px)));
    left: 50%;
    transform: translateX(-50%);
    width: 180px;
    height: 18px;
    background: rgba(0, 0, 0, 0.6);
    border: 2px solid rgba(255, 105, 180, 0.5);
    border-radius: 9px;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;
    z-index: 60;
}

#graze-fill {
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #ff69b4, #ffff00, #ff69b4);
    background-size: 200% 100%;
    animation: grazeShimmer 2s linear infinite;
    border-radius: 7px;
    transition: width 0.15s ease-out;
}

@keyframes grazeShimmer {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
}

/* Pulsing effect when graze meter is FULL */
#graze-meter.graze-full {
    animation: grazePulse 0.5s ease-in-out infinite;
    box-shadow: 0 0 15px #ff69b4, 0 0 30px #ffff00, 0 0 45px #ff69b4;
}

#graze-meter.graze-full #graze-fill {
    background: linear-gradient(90deg, #ffff00, #ff69b4, #00ffff, #ff69b4, #ffff00);
    background-size: 300% 100%;
    animation: grazeRainbow 0.8s linear infinite;
}

#graze-meter.graze-full #graze-label {
    color: #ffff00;
    text-shadow: 0 0 10px #ff69b4, 0 0 20px #ffff00, 1px 1px 0 #000;
    animation: grazeLabelPulse 0.3s ease-in-out infinite alternate;
}

@keyframes grazePulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.08); }
}

@keyframes grazeRainbow {
    0% { background-position: 0% 0; }
    100% { background-position: 300% 0; }
}

@keyframes grazeLabelPulse {
    0% { opacity: 0.8; }
    100% { opacity: 1; }
}

#graze-label {
    position: relative;
    font-size: 10px;
    font-weight: 900;
    letter-spacing: 2px;
    color: #fff;
    text-shadow: 0 0 5px rgba(255, 105, 180, 0.8), 1px 1px 0 #000;
    z-index: 1;
}

#graze-count {
    position: absolute;
    right: 8px;
    font-size: 10px;
    font-weight: 700;
    color: #ffff00;
    text-shadow: 0 0 5px rgba(255, 255, 0, 0.8), 1px 1px 0 #000;
    z-index: 1;
}

#graze-meter.pulse {
    animation: grazePulse 0.3s ease-out;
}

@keyframes grazePulse {
    0% { transform: translateX(-50%) scale(1); }
    50% { transform: translateX(-50%) scale(1.1); border-color: #ffff00; }
    100% { transform: translateX(-50%) scale(1); }
}

/* --- HELP PANEL --- */
#help-panel {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(8px);
    z-index: 250;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    touch-action: pan-y;
    padding: 20px;
    box-sizing: border-box;
}

.help-modal {
    max-width: 450px;
    max-height: 90vh;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    touch-action: pan-y;
}

/* .help-btn, .credits-btn replaced by .btn-primary in Button Design System */

/* Credits panel */
#credits-panel {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0, 0, 0, 0.85);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
}

.credits-modal {
    max-width: 360px;
    text-align: center;
}

.credits-content {
    background: rgba(0, 0, 0, 0.3);
    border: 2px solid #333;
    border-radius: 8px;
    padding: 25px 20px;
    margin: 20px 0;
}

.credits-author {
    color: #bb44ff;
    font-family: 'Courier New', monospace;
    font-size: 22px;
    font-weight: bold;
    margin: 0 0 15px 0;
    text-shadow: 0 0 10px rgba(187, 68, 255, 0.5);
}

.credits-link {
    color: #a569bd;
    font-family: 'Courier New', monospace;
    font-size: 14px;
    text-decoration: none;
    border-bottom: 1px solid #a569bd;
    padding-bottom: 2px;
    transition: color 0.2s, border-color 0.2s;
}

.credits-link:hover {
    color: #d2b4de;
    border-color: #d2b4de;
}

/* What's New notification glow (v4.51) */
.btn-glow-notify {
    animation: btnGlowPulse 1.2s ease-in-out infinite;
}
@keyframes btnGlowPulse {
    0%, 100% {
        box-shadow: 0 0 8px rgba(187, 68, 255, 0.5), 0 0 16px rgba(187, 68, 255, 0.2);
        transform: scale(1);
        filter: brightness(1);
    }
    50% {
        box-shadow: 0 0 24px rgba(187, 68, 255, 1), 0 0 48px rgba(187, 68, 255, 0.6), 0 0 72px rgba(187, 68, 255, 0.2);
        transform: scale(1.15);
        filter: brightness(1.4);
    }
}

/* What's New panel (v4.50) */
#whatsnew-panel {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(8px);
    z-index: 10000;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    box-sizing: border-box;
    touch-action: pan-y;
}
.whatsnew-box {
    background: linear-gradient(180deg, #1a1a2e 0%, #0f0f1a 100%);
    border: 3px solid #bb44ff;
    border-radius: 12px;
    box-shadow: 0 0 30px rgba(187, 68, 255, 0.3);
    width: 100%;
    max-width: 400px;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}
.whatsnew-title {
    color: #bb44ff;
    font-size: 20px;
    font-weight: 900;
    letter-spacing: 3px;
    text-align: center;
    margin: 0;
    padding: 18px 20px 10px;
    border-bottom: 2px solid #bb44ff;
    flex-shrink: 0;
}
.whatsnew-scroll {
    flex: 1;
    min-height: 0;
    overflow-y: scroll;
    -webkit-overflow-scrolling: touch;
    touch-action: pan-y;
    overscroll-behavior: contain;
    padding: 10px 20px;
    text-align: left;
}
.whatsnew-box .btn {
    flex-shrink: 0;
    margin: 15px 20px 20px;
}
@media (max-width: 500px) {
    #whatsnew-panel {
        padding: 0;
    }
    .whatsnew-box {
        max-height: 100vh;
        max-height: 100dvh;
        height: 100vh;
        height: 100dvh;
        max-width: 100%;
        border-radius: 0;
        border: none;
        overflow: visible;
    }
}
.whatsnew-version {
    border-left: 3px solid #bb44ff;
    padding: 8px 0 8px 12px;
    margin-bottom: 14px;
}
.whatsnew-version h3 {
    color: #bb44ff;
    font-size: 14px;
    margin: 0 0 2px;
    letter-spacing: 1px;
}
.whatsnew-version .wn-date {
    color: #666;
    font-size: 10px;
    letter-spacing: 1px;
}
.whatsnew-version ul {
    list-style: none;
    padding: 0;
    margin: 6px 0 0;
}
.whatsnew-version li {
    color: #ccc;
    font-size: 12px;
    line-height: 1.5;
    padding: 2px 0;
}
.whatsnew-version li::before {
    content: "▸ ";
    color: #bb44ff;
}
.whatsnew-planned {
    border-left: 3px solid #6aa9ff;
    padding: 8px 0 8px 12px;
    margin-bottom: 14px;
}
.whatsnew-planned h3 {
    color: #6aa9ff;
    font-size: 14px;
    margin: 0 0 6px;
    letter-spacing: 1px;
}
.whatsnew-planned li {
    color: #999;
    font-size: 12px;
    line-height: 1.5;
    padding: 2px 0;
}
.whatsnew-planned li::before {
    content: "◦ ";
    color: #6aa9ff;
}
.whatsnew-planned ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

/* Privacy link in settings */
.privacy-link {
    display: block;
    color: #888;
    font-family: 'Courier New', monospace;
    font-size: 12px;
    text-decoration: none;
    border-bottom: 1px solid #555;
    padding-bottom: 2px;
    margin: 8px auto 12px;
    width: fit-content;
    transition: color 0.2s;
}
.privacy-link:hover {
    color: #ccc;
}

/* Privacy panel */
#privacy-panel {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0, 0, 0, 0.85);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
}
.privacy-modal {
    max-width: 380px;
    text-align: left;
}
.privacy-content {
    background: rgba(0, 0, 0, 0.3);
    border: 2px solid #333;
    border-radius: 8px;
    padding: 15px;
    margin: 15px 0;
    max-height: 50vh;
    overflow-y: auto;
    font-size: 13px;
    line-height: 1.5;
    color: #ccc;
}
.privacy-content h3 {
    color: #bb44ff;
    font-size: 14px;
    margin: 12px 0 4px;
}
.privacy-content h3:first-child {
    margin-top: 0;
}
.privacy-content p {
    margin: 0 0 8px;
}

.help-section {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid #444;
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 12px;
}

.help-section h3 {
    color: #bb44ff;
    font-size: 14px;
    margin: 0 0 10px 0;
    padding-bottom: 6px;
    border-bottom: 1px solid #444;
}

.help-item {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    margin-bottom: 8px;
}

.help-item:last-child {
    margin-bottom: 0;
}

.help-icon {
    font-size: 18px;
    min-width: 24px;
    text-align: center;
}

.help-text {
    flex: 1;
}

.help-text strong {
    color: #fff;
    font-size: 12px;
    display: block;
    margin-bottom: 2px;
}

.help-text p {
    color: #aaa;
    font-size: 11px;
    margin: 0;
    line-height: 1.4;
}

/* --- MEME POPUP (removed in v4.4 - now canvas MEME_WHISPER) --- */

/* ========================================
   CELL-SHADED UI - Phase 17+
   ======================================== */

/* Quick Settings Row (mute + settings buttons) */
.quick-settings-row {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-bottom: 15px;
}

/* .icon-btn-cell replaced by .btn-icon in Button Design System */

/* Cell-Shaded Modal - Dark Crypto Theme */
.paper-modal {
    background: linear-gradient(180deg, #1a1a2e 0%, #0f0f1a 100%) !important;
    border: 4px solid #bb44ff !important;
    border-radius: 12px !important;
    box-shadow: 0 0 30px rgba(187, 68, 255, 0.3), 8px 8px 0 rgba(0,0,0,0.5) !important;
    padding: 25px 30px !important;
}

.modal-title {
    color: #bb44ff !important;
    font-size: 24px;
    font-weight: 900;
    letter-spacing: 3px;
    margin: 0 0 20px 0;
    text-transform: uppercase;
    border-bottom: 3px solid #bb44ff;
    padding-bottom: 10px;
    text-shadow: 0 0 10px rgba(187, 68, 255, 0.5);
}

/* Setting rows - Dark Crypto style */
.paper-modal .setting-row {
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid #333;
    border-radius: 8px;
    padding: 12px 15px;
    margin-bottom: 12px;
}

.paper-modal .setting-label {
    color: #ccc;
    font-weight: 900;
    font-size: 14px;
    letter-spacing: 1px;
}

/* Bear Market Toggle in Settings */
.setting-bear {
    background: rgba(192, 57, 43, 0.2) !important;
    border-color: #cc2277 !important;
}

.toggle-switch {
    display: flex;
    align-items: center;
    gap: 10px;
    background: #2a2a3e;
    border: 2px solid #444;
    border-radius: 20px;
    padding: 5px 15px 5px 8px;
    cursor: pointer;
    transition: background 0.2s;
}

.switch-track {
    width: 40px;
    height: 22px;
    background: #444;
    border-radius: 11px;
    border: 2px solid #555;
    position: relative;
    transition: background 0.2s;
}

.switch-thumb {
    position: absolute;
    width: 16px;
    height: 16px;
    background: #888;
    border: 2px solid #666;
    border-radius: 50%;
    top: 1px;
    left: 1px;
    transition: left 0.2s;
}

.toggle-switch.active .switch-track {
    background: #cc2277;
    border-color: #ff2d95;
}

.toggle-switch.active .switch-thumb {
    left: 19px;
    background: #fff;
}

.toggle-switch .switch-label {
    font-weight: 900;
    font-size: 12px;
    color: #aaa;
    min-width: 30px;
}

/* .toggle-btn-cell replaced by .btn-toggle in Button Design System */

/* Cell-Shaded Slider - Dark Theme */
.slider-cell {
    -webkit-appearance: none;
    appearance: none;
    width: 140px;
    height: 10px;
    background: #2a2a3e;
    border: 2px solid #444;
    border-radius: 6px;
    outline: none;
}

.slider-cell::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    background: linear-gradient(180deg, #bb44ff 0%, #8822bb 100%);
    border: 2px solid #cc66ff;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 0 10px rgba(187, 68, 255, 0.5);
}

.slider-cell::-moz-range-thumb {
    width: 20px;
    height: 20px;
    background: linear-gradient(180deg, #bb44ff 0%, #8822bb 100%);
    border: 2px solid #cc66ff;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 0 10px rgba(187, 68, 255, 0.5);
}

/* How to Play - Dark Box */
.paper-box {
    background: rgba(0, 0, 0, 0.3) !important;
    border: 2px solid #333 !important;
    border-radius: 8px !important;
    padding: 15px !important;
    margin: 15px 0 !important;
    text-align: left !important;
}

.paper-box h3 {
    color: #bb44ff !important;
    font-size: 14px !important;
    margin: 0 0 10px 0 !important;
    border-bottom: 1px solid #444;
    padding-bottom: 5px;
}

.paper-box p {
    color: #aaa !important;
    font-size: 12px !important;
    margin: 8px 0 !important;
}

.paper-box .icon-tag {
    display: inline-block;
    background: #2a2a3e;
    border: 1px solid #444;
    border-radius: 4px;
    padding: 2px 6px;
    margin-right: 5px;
}

.paper-box .tip-text {
    color: #bb44ff !important;
    font-weight: bold;
}

/* .btn-cell replaced by .btn-primary in Button Design System */

/* Bear mode body class - affect toggle */
body.bear-mode .toggle-switch#bear-toggle {
    background: rgba(192, 57, 43, 0.3);
    border-color: #cc2277;
}

body.bear-mode .toggle-switch#bear-toggle .switch-track {
    background: #cc2277;
    border-color: #ff2d95;
}

body.bear-mode .toggle-switch#bear-toggle .switch-thumb {
    left: 19px;
    background: #fff;
}

body.bear-mode .toggle-switch#bear-toggle .switch-label {
    color: #ff2d95;
}

/* ========================================
   SHIP LAUNCH - TEXT DESTRUCTION EFFECT
   ======================================== */

.text-particle {
    position: fixed;
    pointer-events: none;
    z-index: 9999;
    animation: textExplode 1.2s ease-out forwards;
    text-shadow: 0 0 15px currentColor, 0 0 30px currentColor;
    font-family: inherit;
}

@keyframes textExplode {
    0% {
        opacity: 1;
        transform: translate(0, 0) rotate(0deg) scale(1.2);
    }
    30% {
        opacity: 1;
        transform: translate(calc(var(--vx) * 0.3), calc(var(--vy) * 0.3)) rotate(calc(var(--rot) * 0.3)) scale(1);
    }
    100% {
        opacity: 0;
        transform: translate(var(--vx), var(--vy)) rotate(var(--rot)) scale(0.2);
    }
}

/* ========================================
   DIALOGUE SYSTEM - Story/Visual Novel
   ======================================== */

.dialogue-container {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 20px;
    padding-bottom: calc(20px + var(--pwa-bottom-inset, env(safe-area-inset-bottom, 0px)));
    pointer-events: none;
    z-index: 200;
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.3s ease, transform 0.3s ease;
}

.dialogue-container.visible {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
}

.dialogue-box {
    background: rgba(0, 0, 0, 0.92);
    border: 3px solid #bb44ff;
    border-radius: 12px;
    padding: 15px 20px;
    max-width: 500px;
    margin: 0 auto;
    box-shadow:
        0 0 20px rgba(187, 68, 255, 0.4),
        inset 0 0 30px rgba(0, 0, 0, 0.5);
    position: relative;
}

.dialogue-box::before {
    content: '';
    position: absolute;
    top: -1px;
    left: 20px;
    right: 20px;
    height: 2px;
    background: linear-gradient(90deg, transparent, #bb44ff, transparent);
}

.dialogue-speaker {
    font-size: 14px;
    font-weight: 900;
    letter-spacing: 3px;
    color: #bb44ff;
    margin-bottom: 8px;
    text-transform: uppercase;
    text-shadow: 0 0 10px currentColor;
}

.dialogue-text {
    font-size: 16px;
    line-height: 1.5;
    color: #fff;
    min-height: 24px;
}

.dialogue-tap-hint {
    position: absolute;
    bottom: 8px;
    right: 15px;
    font-size: 9px;
    color: #666;
    letter-spacing: 1px;
    animation: tapHintPulse 1.5s ease-in-out infinite;
}

@keyframes tapHintPulse {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 1; }
}

/* Speaker color variants */
.dialogue-speaker.speaker-btc { color: #ffaa00; }
.dialogue-speaker.speaker-eth { color: #8c7ae6; }
.dialogue-speaker.speaker-sol { color: #00d2d3; }
.dialogue-speaker.speaker-powell { color: #ff2d95; }
.dialogue-speaker.speaker-fed { color: #cc2277; }
.dialogue-speaker.speaker-system { color: #00f0ff; }
.dialogue-speaker.speaker-player { color: #00ff66; }

/* ========================================
   CAMPAIGN VICTORY SCREEN
   ======================================== */

.campaign-victory-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(ellipse at center, rgba(50, 30, 0, 0.95) 0%, rgba(0, 0, 0, 0.98) 100%);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9500;
    animation: victoryFadeIn 0.5s ease-out;
}

@keyframes victoryFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.victory-content {
    text-align: center;
    padding: 40px;
}

.victory-title {
    font-size: clamp(32px, 8vw, 56px);
    font-weight: 900;
    color: #bb44ff;
    text-shadow:
        0 0 20px rgba(187, 68, 255, 0.8),
        0 0 40px rgba(187, 68, 255, 0.5),
        0 0 60px rgba(187, 68, 255, 0.3),
        -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000;
    margin-bottom: 15px;
    animation: victoryPulse 2s ease-in-out infinite;
}

@keyframes victoryPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.victory-subtitle {
    font-size: 18px;
    color: #fff;
    letter-spacing: 4px;
    margin-bottom: 30px;
    text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
}

.boss-trophies {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin: 30px 0;
}

.trophy {
    font-size: 32px;
    padding: 15px 25px;
    background: linear-gradient(135deg, rgba(187, 68, 255, 0.2) 0%, rgba(187, 68, 255, 0.1) 100%);
    border: 3px solid #bb44ff;
    border-radius: 12px;
    box-shadow: 0 0 20px rgba(187, 68, 255, 0.4);
    animation: trophyBounce 1s ease-in-out infinite;
}

.trophy:nth-child(2) { animation-delay: 0.2s; }
.trophy:nth-child(3) { animation-delay: 0.4s; }

@keyframes trophyBounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.final-score {
    font-size: 28px;
    font-weight: 900;
    color: var(--neon-violet);
    margin: 30px 0 15px;
    text-shadow: 0 0 15px rgba(187, 68, 255, 0.8);
}

.ng-plus-info {
    font-size: 14px;
    color: #888;
    margin-bottom: 30px;
    letter-spacing: 2px;
}

.victory-actions {
    display: flex;
    flex-direction: column;
    gap: 15px;
    align-items: center;
}

/* ========================================
   MANUAL MODAL - Interactive Player Manual
   ======================================== */

#manual-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    backdrop-filter: blur(10px);
    z-index: 300;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    box-sizing: border-box;
    animation: manualFadeIn 0.3s ease-out;
    touch-action: pan-y;
}

@keyframes manualFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.manual-container {
    background: linear-gradient(180deg, #1a1a2e 0%, #0a0a15 100%);
    border: 3px solid #bb44ff;
    border-radius: 16px;
    width: 100%;
    max-width: 550px;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    box-shadow:
        0 0 40px rgba(187, 68, 255, 0.3),
        0 0 80px rgba(187, 68, 255, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    overflow: hidden;
}

.manual-title {
    color: #bb44ff;
    font-size: 22px;
    font-weight: 900;
    letter-spacing: 4px;
    text-align: center;
    margin: 0;
    padding: 18px 20px 12px;
    text-shadow: 0 0 20px rgba(187, 68, 255, 0.6);
    border-bottom: 2px solid rgba(187, 68, 255, 0.3);
    flex-shrink: 0;
}

/* Tab Navigation */
.manual-tabs {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 6px;
    padding: 12px 15px;
    background: rgba(0, 0, 0, 0.3);
    border-bottom: 1px solid rgba(187, 68, 255, 0.2);
    flex-shrink: 0;
}

.manual-tab {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 3px;
    padding: 8px 12px;
    background: rgba(255, 255, 255, 0.03);
    border: 2px solid rgba(255, 255, 255, 0.15);
    border-radius: 8px;
    color: rgba(255, 255, 255, 0.5);
    cursor: pointer;
    transition: all 0.2s ease;
    min-width: 70px;
}

.manual-tab:hover {
    background: rgba(187, 68, 255, 0.1);
    border-color: rgba(187, 68, 255, 0.4);
    color: rgba(255, 255, 255, 0.8);
}

.manual-tab.active {
    background: rgba(187, 68, 255, 0.2);
    border-color: #bb44ff;
    color: #bb44ff;
    box-shadow: 0 0 15px rgba(187, 68, 255, 0.3);
}

.tab-icon {
    font-size: 18px;
}

.tab-label {
    font-size: 9px;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
}

/* Content Area */
.manual-content {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    scrollbar-width: thin;
    scrollbar-color: #bb44ff #1a1a2e;
    -webkit-overflow-scrolling: touch;
    touch-action: pan-y;
}

.manual-content::-webkit-scrollbar {
    width: 8px;
}

.manual-content::-webkit-scrollbar-track {
    background: #1a1a2e;
    border-radius: 4px;
}

.manual-content::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, #bb44ff 0%, #9933dd 100%);
    border-radius: 4px;
}

.manual-content::-webkit-scrollbar-thumb:hover {
    background: #cc66ff;
}

/* Panels (content per tab) */
.manual-panel {
    display: none;
    animation: panelFadeIn 0.3s ease-out;
}

.manual-panel.active {
    display: block;
}

@keyframes panelFadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.panel-title {
    color: #bb44ff;
    font-size: 18px;
    font-weight: 900;
    margin: 0 0 12px 0;
    text-shadow: 0 0 10px rgba(187, 68, 255, 0.5);
}

.panel-intro {
    color: #ccc;
    font-size: 13px;
    line-height: 1.6;
    margin: 0 0 20px 0;
}

/* Sections */
.manual-section {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 15px;
}

.manual-section h4 {
    color: #fff;
    font-size: 14px;
    font-weight: 700;
    margin: 0 0 12px 0;
    padding-bottom: 8px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

/* Platform-specific visibility (global) */
.desktop-only { display: block; }
.mobile-only { display: none; }

body.is-touch .desktop-only { display: none; }
body.is-touch .mobile-only { display: block; }

/* For inline elements like <p> */
p.desktop-only { display: block; }
p.mobile-only { display: none; }
body.is-touch p.desktop-only { display: none; }
body.is-touch p.mobile-only { display: block; }

.section-note {
    color: #888;
    font-size: 11px;
    font-style: italic;
    margin: -8px 0 12px 0;
}

.section-note.warning {
    color: #ff6b6b;
    font-weight: 600;
    text-align: center;
    padding: 8px;
    background: rgba(255, 100, 100, 0.1);
    border-radius: 6px;
    margin: 10px 0;
}

.death-penalty {
    background: transparent;
    border: none;
    padding: 0;
}

/* Lists */
.manual-list {
    color: #aaa;
    font-size: 12px;
    line-height: 1.8;
    margin: 0;
    padding-left: 20px;
}

.manual-list li {
    margin-bottom: 6px;
}

/* Tables */
.manual-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
}

.manual-table th,
.manual-table td {
    padding: 10px 12px;
    text-align: left;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
}

.manual-table th {
    color: #bb44ff;
    font-weight: 700;
    width: 30%;
}

.manual-table td {
    color: #ccc;
}

.manual-table tr:last-child th,
.manual-table tr:last-child td {
    border-bottom: none;
}

/* Power-up table */
.powerup-table .pu-icon {
    font-size: 18px;
    width: 35px;
    text-align: center;
}

.powerup-table .pu-name {
    color: #bb44ff;
    font-weight: 700;
    width: 80px;
}

/* Enemy table */
.enemy-table .enemy-symbol {
    font-size: 20px;
    font-weight: 900;
    width: 40px;
    text-align: center;
}

/* Tier colors */
.tier-weak { color: #00ff66 !important; }
.tier-medium { color: #ffaa00 !important; }
.tier-strong { color: #ff2d95 !important; }

/* Boss cards */
.boss-cards {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin: 20px 0;
    flex-wrap: wrap;
}

.boss-card {
    background: rgba(0, 0, 0, 0.4);
    border: 2px solid #444;
    border-radius: 10px;
    padding: 15px;
    text-align: center;
    min-width: 100px;
    transition: all 0.2s ease;
}

.boss-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
}

.boss-card.fed { border-color: #00ff66; }
.boss-card.bce { border-color: #003399; }
.boss-card.boj { border-color: #bc002d; }

.boss-symbol {
    font-size: 32px;
    font-weight: 900;
    margin-bottom: 8px;
}

.boss-card.fed .boss-symbol { color: #00ff66; }
.boss-card.bce .boss-symbol { color: #003399; }
.boss-card.boj .boss-symbol { color: #bc002d; }

.boss-name {
    font-size: 12px;
    font-weight: 900;
    color: #fff;
    letter-spacing: 1px;
    margin-bottom: 5px;
}

.boss-style {
    font-size: 10px;
    color: #888;
}

/* Phase list */
.phase-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.phase-list li {
    padding: 8px 12px;
    margin-bottom: 8px;
    border-radius: 6px;
    font-size: 12px;
    color: #ccc;
}

.phase-list .phase-1 {
    background: rgba(46, 204, 113, 0.15);
    border-left: 3px solid #00ff66;
}

.phase-list .phase-2 {
    background: rgba(241, 196, 15, 0.15);
    border-left: 3px solid #f1c40f;
}

.phase-list .phase-3 {
    background: rgba(255, 45, 149, 0.15);
    border-left: 3px solid #ff2d95;
}

/* Tip cards */
.tip-card {
    background: rgba(0, 0, 0, 0.3);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 15px;
}

.tip-card h4 {
    color: #fff;
    font-size: 14px;
    margin: 0 0 10px 0;
}

.tip-card p {
    color: #aaa;
    font-size: 12px;
    margin: 0 0 10px 0;
    line-height: 1.5;
}

.tip-card ul {
    color: #ccc;
    font-size: 12px;
    margin: 0 0 10px 0;
    padding-left: 20px;
}

.tip-card ul li {
    margin-bottom: 4px;
}

.tip-highlight {
    color: #bb44ff !important;
    font-weight: 700;
    font-style: italic;
}

/* Tip card variants */
.tip-card.hodl { border-color: rgba(187, 68, 255, 0.4); }
.tip-card.hodl h4 { color: #bb44ff; }

.tip-card.graze { border-color: rgba(255, 105, 180, 0.4); }
.tip-card.graze h4 { color: #ff69b4; }
.tip-card.graze .tip-highlight { color: #ff69b4 !important; }

.tip-card.shield { border-color: rgba(0, 240, 255, 0.4); }
.tip-card.shield h4 { color: #00f0ff; }

.tip-card.boss-tip { border-color: rgba(46, 204, 113, 0.4); }
.tip-card.boss-tip h4 { color: #00ff66; }

/* Bear Market section */
.bear-section {
    background: rgba(192, 57, 43, 0.1) !important;
    border-color: rgba(192, 57, 43, 0.3) !important;
}

.bear-section h4 {
    color: #ff2d95 !important;
}

/* Close button */
.manual-close {
    margin: 15px 20px 20px;
    flex-shrink: 0;
}

/* Mobile responsive */
@media (max-width: 500px) {
    #manual-modal {
        padding: 0;
    }

    .manual-container {
        max-height: 100vh;
        max-height: 100dvh;
        max-width: 100%;
        height: 100vh; /* v4.21: explicit height for iOS flex scroll */
        height: 100dvh;
        border-radius: 0;
        border: none;
        overflow: visible; /* v4.21: override hidden on mobile — no border-radius to clip */
    }

    .manual-title {
        font-size: 18px;
        padding: 14px 15px 10px;
        padding-top: calc(14px + env(safe-area-inset-top, 0px)); /* v4.21: iPhone notch */
    }

    .manual-v2 .manual-scroll {
        padding: 15px;
    }

    .manual-content {
        padding: 15px;
    }

    .manual-close {
        margin: 15px 20px;
        margin-bottom: calc(20px + var(--pwa-bottom-inset, env(safe-area-inset-bottom, 0px))); /* v4.21: iPhone home bar */
    }
}

/* --- PWA INSTALL BANNER --- */
#pwa-install-banner {
    position: absolute;
    bottom: calc(280px + var(--pwa-bottom-inset, env(safe-area-inset-bottom, 0px)));
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    max-width: 380px;
    z-index: 200;
    display: flex;
    justify-content: center;
    animation: pwaFadeIn 0.4s ease-out;
}

@keyframes pwaFadeIn {
    from { opacity: 0; transform: translateX(-50%) translateY(20px); }
    to   { opacity: 1; transform: translateX(-50%) translateY(0); }
}

.pwa-banner-content {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    width: 100%;
    background: rgba(0, 0, 0, 0.9);
    border: 1px solid #bb44ff;
    border-radius: 10px;
    padding: 12px 14px;
    font-family: Consolas, "Courier New", monospace;
    box-shadow: 0 0 20px rgba(187, 68, 255, 0.2);
}

#pwa-banner-text {
    flex: 1;
    color: #fff;
    font-size: 12px;
    line-height: 1.4;
}

#pwa-banner-text .pwa-share-icon {
    display: inline-block;
    width: 16px;
    height: 16px;
    vertical-align: middle;
    margin: 0 2px;
}

/* .pwa-banner-btn replaced by .btn-pwa in Button Design System */

.pwa-banner-close {
    background: none;
    border: none;
    color: rgba(255, 255, 255, 0.5);
    font-size: 20px;
    cursor: pointer;
    padding: 0 4px;
    line-height: 1;
    transition: color 0.2s;
}

.pwa-banner-close:active {
    color: #fff;
}

/* ========================================
   MANUAL v2 - Scrollable Sections (v4.12.0)
   ======================================== */

.manual-v2 .manual-scroll {
    flex: 1;
    min-height: 0;
    overflow-y: scroll; /* v4.21: explicit scroll (iOS needs 'scroll' not 'auto') */
    padding: 20px;
    scrollbar-width: thin;
    scrollbar-color: #bb44ff #1a1a2e;
    -webkit-overflow-scrolling: touch;
    touch-action: pan-y;
    overscroll-behavior: contain; /* v4.21: Prevent scroll chaining to parent on iOS */
}

.manual-v2 .manual-scroll::-webkit-scrollbar {
    width: 8px;
}

.manual-v2 .manual-scroll::-webkit-scrollbar-track {
    background: #1a1a2e;
    border-radius: 4px;
}

.manual-v2 .manual-scroll::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, #bb44ff 0%, #9933dd 100%);
    border-radius: 4px;
}

.manual-section-v2 {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    padding: 16px;
    margin-bottom: 18px;
}

.section-heading {
    color: #bb44ff;
    font-size: 16px;
    font-weight: 900;
    letter-spacing: 3px;
    margin: 0 0 12px 0;
    padding-bottom: 8px;
    border-bottom: 2px solid rgba(187, 68, 255, 0.3);
}

.manual-body {
    color: #ccc;
    font-size: 14px;
    line-height: 1.6;
    margin: 0 0 10px 0;
}

.manual-warn {
    color: #ff6b6b;
    font-weight: 600;
}

.tip-compact p {
    color: #ccc;
    font-size: 14px;
    line-height: 1.6;
    margin: 0 0 10px 0;
}

.tip-compact strong {
    color: #bb44ff;
}

/* ========================================
   TUTORIAL OVERLAY (v4.12.0)
   ======================================== */

#tutorial-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.75);
    z-index: 9500;
    display: flex;
    justify-content: center;
    align-items: center;
    animation: tutorialFadeIn 0.3s ease-out;
}

@keyframes tutorialFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.tutorial-container {
    background: linear-gradient(180deg, #1a1a2e 0%, #0a0a15 100%);
    border: 3px solid #bb44ff;
    border-radius: 16px;
    width: 90%;
    max-width: 400px;
    padding: 30px 25px;
    text-align: center;
    box-shadow:
        0 0 40px rgba(187, 68, 255, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

.tutorial-unified {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 10px;
    padding: 22px 18px;
    max-width: 400px;
    margin: auto;
}

.tutorial-section {
    width: 100%;
    text-align: center;
}

/* --- Tutorial step system (v5.12 progressive) --- */
.tut-step {
    display: none;
    width: 100%;
}
.tut-step--active {
    display: block;
    animation: tutStepIn 0.35s ease-out both;
}
.tut-step--out {
    display: block;
    animation: tutStepOut 0.25s ease-in forwards;
}

@keyframes tutStepIn {
    from { opacity: 0; transform: translateY(40px) scale(0.9); }
    to   { opacity: 1; transform: translateY(0) scale(1); }
}
@keyframes tutStepOut {
    from { opacity: 1; transform: translateX(0); }
    to   { opacity: 0; transform: translateX(-60px); }
}

@media (prefers-reduced-motion: reduce) {
    .tut-step--active { animation: none; }
    .tut-step--out { animation: none; opacity: 0; }
}

/* Progress dots */
.tut-dots {
    display: flex;
    gap: 8px;
    justify-content: center;
    margin-bottom: 10px;
}
.tut-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    transition: background 0.3s, box-shadow 0.3s;
}
.tut-dot.active {
    background: #bb44ff;
    box-shadow: 0 0 8px rgba(187, 68, 255, 0.6);
}

.tut-card {
    display: flex;
    align-items: center;
    gap: 14px;
    text-align: left;
    padding: 16px 18px;
    border-radius: 12px;
    border-left: 3px solid transparent;
    background: rgba(255, 255, 255, 0.04);
}

.tut-icon {
    flex-shrink: 0;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.06);
}

.tut-card--move {
    border-left-color: #bb44ff;
}
.tut-card--move .tut-icon {
    color: #bb44ff;
    background: rgba(187, 68, 255, 0.12);
    letter-spacing: -4px;
}

.tut-card--obj {
    border-left-color: #ff2d95;
}
.tut-card--obj .tut-icon {
    color: #ff2d95;
    background: rgba(255, 45, 149, 0.12);
    font-size: 22px;
}

.tut-card--shield {
    border-left-color: #00f0ff;
}
.tut-card--shield .tut-icon {
    color: #00f0ff;
    background: rgba(0, 240, 255, 0.12);
    font-size: 22px;
}
.tut-card--shield .tutorial-text {
    color: #00f0ff;
}

/* Control zone hint — grey area below graze meter, visible during PLAY only */
#control-zone-hint {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: calc(80px + var(--pwa-bottom-inset, env(safe-area-inset-bottom, 0px)));
    background: rgba(255, 255, 255, 0.07);
    z-index: 10;
    pointer-events: none;
    display: none;
}

.tutorial-title {
    color: #bb44ff;
    font-size: 18px;
    font-weight: 900;
    letter-spacing: 5px;
    margin: 0 0 6px 0;
    text-shadow: 0 0 15px rgba(187, 68, 255, 0.5);
    text-transform: uppercase;
}

.tutorial-text {
    color: #ccc;
    font-size: 14px;
    line-height: 1.5;
    margin: 0;
    white-space: pre-line;
}

.tutorial-actions {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-top: 25px;
}

/* .tutorial-btn, .tutorial-skip, .tutorial-next replaced by Button Design System */

/* ========================================
   ACCESSIBILITY - v4.12.0
   ======================================== */

/* Small screen title fallback */
@media (max-height: 600px) {
    .intro-title {
        font-size: clamp(42px, 10vw, 56px);
    }
}

/* Reduced Motion - Disable all animations for users who prefer it */
@media (prefers-reduced-motion: reduce) {
    .title-fiat,
    .title-crypto,
    .title-vs,
    .btn-tap-start,
    .btn-cta,
    #intro-ship-canvas,
    .hud-score-value,
    .hud-score-value.score-normal,
    .hud-score-value.score-big,
    .hud-score-value.score-massive,
    .hud-score-value.score-legendary,
    .hud-score-value.score-new-record,
    .hud-score-value.score-record-break,
    .shield-btn-wrapper.ready .shield-btn-face,
    .shield-btn-wrapper.active .shield-btn-face,
    .hyper-btn-wrapper.ready .hyper-btn-face,
    .hyper-btn-wrapper.active .hyper-btn-face,
    .text-particle,
    .boss-slot.current,
    .trophy {
        animation: none !important;
    }

    .btn-tap-start::before,
    .btn-cta::before {
        animation: none !important;
    }

    * {
        transition-duration: 0.01s !important;
    }
}

/* === ARCADE MODIFIER CHOICE OVERLAY === */
#modifier-overlay {
    position: fixed;
    inset: 0;
    z-index: 9800;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: rgba(3, 3, 8, 0.92);
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    padding: 20px;
}

.modifier-header {
    font: bold 22px 'Courier New', monospace;
    color: var(--neon-violet);
    text-transform: uppercase;
    letter-spacing: 3px;
    margin-bottom: 24px;
    text-shadow: 0 0 10px rgba(187, 68, 255, 0.6);
}

.modifier-cards {
    display: flex;
    gap: 14px;
    justify-content: center;
    flex-wrap: wrap;
    max-width: 500px;
}
.modifier-cards-2 {
    max-width: 340px;
}

.modifier-card {
    flex: 0 0 140px;
    background: rgba(10, 8, 37, 0.95);
    border: 1px solid rgba(187, 68, 255, 0.35);
    border-radius: 12px;
    padding: 18px 12px;
    text-align: center;
    cursor: pointer;
    transition: transform 0.2s, border-color 0.2s, box-shadow 0.2s;
    animation: modCardEnter 0.35s ease-out both;
    position: relative;
    overflow: hidden;
}
.modifier-card::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(180deg, rgba(var(--cat-color-rgb, 187, 68, 255), 0.08) 0%, transparent 60%);
    pointer-events: none;
}
.modifier-card:hover, .modifier-card:active {
    transform: scale(1.06);
    border-color: var(--cat-color, var(--neon-violet));
    box-shadow: 0 0 20px rgba(187, 68, 255, 0.35);
}

.mod-icon {
    font-size: 36px;
    margin-bottom: 8px;
}
.mod-name {
    font: bold 14px 'Courier New', monospace;
    color: #fff;
    margin-bottom: 6px;
}
.mod-stack {
    color: var(--neon-cyan);
    font-size: 12px;
}
.mod-desc {
    font: 11px 'Courier New', monospace;
    color: rgba(255, 255, 255, 0.7);
    line-height: 1.3;
    margin-bottom: 8px;
    min-height: 28px;
}
.mod-category {
    font: bold 9px 'Courier New', monospace;
    letter-spacing: 2px;
    text-transform: uppercase;
}

.modifier-card-selected {
    transform: scale(1.12);
    border-color: #39ff14;
    box-shadow: 0 0 30px rgba(57, 255, 20, 0.5);
    transition: all 0.3s ease-out;
}
.modifier-card-rejected {
    opacity: 0;
    transform: scale(0.8);
    transition: all 0.3s ease-out;
    pointer-events: none;
}

@keyframes modCardEnter {
    from { opacity: 0; transform: translateY(40px) scale(0.9); }
    to   { opacity: 1; transform: translateY(0) scale(1); }
}

/* Arcade gameover extra rows */
#arcade-combo-row {
    display: flex;
    gap: 20px;
    justify-content: center;
    font: 12px 'Courier New', monospace;
    color: rgba(255, 255, 255, 0.7);
    margin-top: 6px;
}
#arcade-combo-row b {
    color: var(--neon-cyan);
}

/* ======================================
   NICKNAME OVERLAY (v5.17)
   ====================================== */
#nickname-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.92);
    backdrop-filter: blur(10px);
    z-index: 10100;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    box-sizing: border-box;
}
.nickname-box {
    background: linear-gradient(180deg, #1a1a2e 0%, #0f0f1a 100%);
    border: 3px solid #bb44ff;
    border-radius: 12px;
    box-shadow: 0 0 40px rgba(187, 68, 255, 0.4);
    width: 100%;
    max-width: 360px;
    padding: 30px 24px;
    text-align: center;
}
.nickname-title {
    color: #bb44ff;
    font-size: 18px;
    font-weight: 900;
    letter-spacing: 3px;
    margin: 0 0 20px;
}
.nickname-input {
    width: 100%;
    background: rgba(187, 68, 255, 0.08);
    border: 2px solid rgba(187, 68, 255, 0.4);
    border-radius: 8px;
    color: #fff;
    font: 700 20px 'Courier New', monospace;
    text-align: center;
    text-transform: uppercase;
    padding: 12px;
    box-sizing: border-box;
    outline: none;
    letter-spacing: 2px;
    transition: border-color 0.2s;
}
.nickname-input:focus {
    border-color: #bb44ff;
    box-shadow: 0 0 15px rgba(187, 68, 255, 0.3);
}
.nickname-input::placeholder {
    color: rgba(187, 68, 255, 0.35);
    font-size: 13px;
    letter-spacing: 1px;
}
.nickname-error {
    color: #ff2d95;
    font: 600 12px 'Courier New', monospace;
    margin: 8px 0 0;
}
.nickname-box .btn {
    margin-top: 18px;
    width: 100%;
}

/* ======================================
   LEADERBOARD PANEL (v5.17)
   ====================================== */
#leaderboard-panel {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(8px);
    z-index: 10000;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    box-sizing: border-box;
    touch-action: pan-y;
}
.leaderboard-box {
    background: linear-gradient(180deg, #1a1a2e 0%, #0f0f1a 100%);
    border: 3px solid #bb44ff;
    border-radius: 12px;
    box-shadow: 0 0 30px rgba(187, 68, 255, 0.3);
    width: 100%;
    max-width: 420px;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}
.leaderboard-title {
    color: #bb44ff;
    font-size: 20px;
    font-weight: 900;
    letter-spacing: 3px;
    text-align: center;
    margin: 0;
    padding: 18px 20px 10px;
    border-bottom: 2px solid #bb44ff;
    flex-shrink: 0;
}
.leaderboard-scroll {
    flex: 1;
    min-height: 0;
    overflow-y: scroll;
    -webkit-overflow-scrolling: touch;
    touch-action: pan-y;
    overscroll-behavior: contain;
    padding: 0;
}
#lb-loading, #lb-empty {
    color: rgba(255, 255, 255, 0.5);
    font: 600 14px 'Courier New', monospace;
    text-align: center;
    padding: 40px 20px;
    letter-spacing: 2px;
}
.lb-table {
    width: 100%;
    border-collapse: collapse;
    font: 600 13px 'Courier New', monospace;
}
.lb-table thead {
    position: sticky;
    top: 0;
    z-index: 1;
}
.lb-table th {
    background: #1a1a2e;
    color: rgba(187, 68, 255, 0.7);
    font-size: 11px;
    letter-spacing: 2px;
    padding: 10px 8px;
    text-align: left;
    border-bottom: 1px solid rgba(187, 68, 255, 0.3);
}
.lb-table td {
    padding: 8px;
    color: rgba(255, 255, 255, 0.85);
    border-bottom: 1px solid rgba(255, 255, 255, 0.06);
}
.lb-col-rank { width: 36px; text-align: center; }
.lb-col-name { /* flex */ }
.lb-col-score { width: 80px; text-align: right; }
.lb-col-ship { width: 40px; text-align: center; }
.lb-col-plat { width: 28px; text-align: center; font-size: 14px; }
/* Top 3 highlights */
.lb-rank-1 td { color: #ffd700; }
.lb-rank-2 td { color: #c0c0c0; }
.lb-rank-3 td { color: #cd7f32; }
.lb-rank-1 td:first-child,
.lb-rank-2 td:first-child,
.lb-rank-3 td:first-child { font-weight: 900; }
/* Self highlight */
.lb-self { background: rgba(0, 240, 255, 0.08); }
.lb-self td { color: #00f0ff; }

.lb-player-rank {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    padding: 12px 20px;
    border-top: 1px solid rgba(187, 68, 255, 0.3);
    flex-shrink: 0;
}
.lb-rank-label {
    color: rgba(255, 255, 255, 0.6);
    font: 600 12px 'Courier New', monospace;
    letter-spacing: 2px;
}
.lb-rank-value {
    color: #00f0ff;
    font: 900 22px 'Courier New', monospace;
    text-shadow: 0 0 10px rgba(0, 240, 255, 0.5);
}
.lb-actions {
    flex-shrink: 0;
    padding: 12px 20px 18px;
}
.lb-actions .btn {
    width: 100%;
}

/* ======================================
   GAMEOVER RANK SECTION (v5.17)
   ====================================== */
#gameover-rank-section {
    margin: 10px 0;
    text-align: center;
}
.gameover-rank-badge {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 8px;
}
.gameover-rank-badge .rank-label {
    color: rgba(255, 255, 255, 0.6);
    font: 600 11px 'Courier New', monospace;
    letter-spacing: 2px;
}
.gameover-rank-badge .rank-value {
    color: #00f0ff;
    font: 900 20px 'Courier New', monospace;
    text-shadow: 0 0 8px rgba(0, 240, 255, 0.4);
}
.gameover-top5 {
    font: 600 11px 'Courier New', monospace;
    color: rgba(255, 255, 255, 0.7);
    margin: 6px 0 10px;
    line-height: 1.6;
}
.gameover-top5 .top5-gold { color: #ffd700; }
.gameover-top5 .top5-self { color: #00f0ff; }
#btn-view-lb {
    margin-bottom: 6px;
}
.gameover-rank-tier {
    font: 900 16px 'Courier New', monospace;
    letter-spacing: 3px;
    margin-bottom: 4px;
    animation: rankTierPulse 1.5s ease-in-out infinite;
}
.rank-tier-3 { color: #ffd700; text-shadow: 0 0 12px rgba(255, 215, 0, 0.6), 0 0 30px rgba(255, 215, 0, 0.3); }
.rank-tier-5 { color: #c0c0c0; text-shadow: 0 0 10px rgba(192, 192, 192, 0.5); }
.rank-tier-10 { color: #00f0ff; text-shadow: 0 0 8px rgba(0, 240, 255, 0.4); }
@keyframes rankTierPulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.85; transform: scale(1.05); }
}

/* Mobile fullscreen leaderboard */
@media (max-width: 500px) {
    #leaderboard-panel { padding: 0; }
    .leaderboard-box {
        max-height: 100vh;
        max-height: 100dvh;
        height: 100vh;
        height: 100dvh;
        max-width: 100%;
        border-radius: 0;
        border: none;
    }
}

